function PointJS(R,y,U){this._logo="https://mult-uroki.ru/media/pointjs/gamedev_4.png";var m=window,F=this,V=!1,Ca="fixed",kb=0,lb=0,na=-1,mb=function(a){a=a.getBoundingClientRect();return{y:a.top+m.pageYOffset,x:a.left+m.pageXOffset}},ta=function(a){for(var b=1;a;)b+=a.style.zIndex,a=a.offsetParent;return b};if(1===arguments.length){V=arguments[0];var lc=mb(V);kb=lc.x;lb=lc.y;R=V.offsetWidth;y=V.offsetHeight;Ca="absolute";na=ta(V)}var Va=!0,Rb=!0,mc=!0,ya=!1,Wa=!0,q=R,r=y,Da=R,Ea=y,S=q/2,T=r/2,Fa=
1,Ga=1,h={x:0,y:0},z={fillStyle:"black",strokeStyle:"black",globalAlpha:1,font:"serif",textBaseline:"top"},ua=function(a){console.log("[PointJS] : ",a)};"undefined"!==typeof POINTJS_USER_LOG&&(ua=POINTJS_USER_LOG);var nb=function(a){var b=decodeURI(a.stack.toString().replace(/(@|[\(\)]|[\w]+:\/\/)/g,""));b=b.split(/\n/);b=(""===b[2]?b[0]:b[1]).split("/");b=b[b.length-1].split(":");ua('ERROR "'+a.toString()+'" \n in      '+b[0]+" \n line :   "+b[1]+" \n symbol : "+b[2])};this.game={};this.levels={};
this.camera={};this.keyControl={};this.mouseControl={};this.touchControl={};this.system={};this.vector={};this.math={};this.layers={};this.colors={};this.brush={};this.audio={};this.wAudio={};this.resources={};this.tiles={};this.OOP={};this.memory={};this.modules={};this.zList={};this.filters={};this.presets={};this.system.log=ua;this.system.consoleLog=function(a){this.log=!0===a?console.log:ua};this.system.setTitle=function(a){m.document.title=a};this.system.setSettings=function(a){Va=C(a.isShowError)?
a.isShowError:!0;Rb=C(a.isStopForError)?a.isStopForError:!0;mc=C(a.isAutoClear)?a.isAutoClear:!1;C(a.isZBuffer)};this.system.setDefaultSettings=function(a){for(var b in a)z[b]=a[b];k.save()};this.system.setSmoothing=function(a){Wa=a;k.msImageSmoothingEnabled=Wa;k.imageSmoothingEnabled=Wa};this.system.restart=function(a){m.location.reload(a)};var Rc={name:"PointJS IDE",desc:"HTML5 Game Engine for JavaScript",author:"\u0410\u043b\u0435\u043a\u0441\u0430\u043d\u0434\u0440 \u041f\u0442\u0438\u0447\u043a\u0438\u043d (multuroki@gmail.com)",
version:"3.31.03.23"};this.system.getInfo=function(){return Rc};this.modules["import"]=function(a,b){J.add();var c=new XMLHttpRequest;c.open("GET",a,!0);c.onload=function(){var d={constructor:function(){}},e=c.responseText.toString().replace(/PointJS.Module/i,"Module.constructor");(new Function("Module",e))(d);d=new d.constructor(F,m);J.load();b(d)};c.send()};this.modules.importSync=function(a){try{var b=new XMLHttpRequest;b.open("GET",a,!1);b.send()}catch(c){return}a={constructor:function(){}};b=
b.responseText.toString().replace(/PointJS.Module/i,"Module.constructor");(new Function("Module",b))(a);return new a.constructor(F,m)};var va=function(a,b){b.prototype=Object.create(a.prototype);b.prototype.constructor=b},wa=function(a,b,c){this.x=a||0;this.y=b||0;this.z=c||0};wa.prototype={abs:function(){return new wa(Math.abs(this.x),Math.abs(this.y),Math.abs(this.z))},invert:function(){return new wa(-this.x,-this.y,-this.z)},plus:function(a){return new wa(this.x+a.x,this.y+a.y,this.z+a.z)},minus:function(a){return new wa(this.x-
a.x,this.y-a.y,this.z-a.z)},inc:function(a){return new wa(this.x*a.x,this.y*a.y,this.z*a.z)},div:function(a){return new wa(this.x/a.x,this.y/a.y,this.z/a.z)},"int":function(){return new wa(this.x>>0,this.y>>0,this.z>>0)}};var g=function(a,b,c){return new wa(a,b,c)},G=function(a,b,c){return{w:a,h:b,d:c}},ob=function(a,b){return{x:a.x+b.x,y:a.y+b.y,z:a.z+b.z}},M=function(a,b,c){if(c){var d=K(c);c=a.x-b.x;a=a.y-b.y;var e=Math.cos(d);d=Math.sin(d);return g(c*e-a*d+b.x,c*d+a*e+b.y)}return g(a.x,a.y)},
Xa=function(a,b){return 180/Math.PI*Math.atan2(b.y-a.y,b.x-a.x)},Ha=function(a,b){if(b){var c,d=0;var e=0;var l=b.length;for(c=b.length-1;e<l;c=e++)b[e].y>a.y!==b[c].y>a.y&&a.x<(b[c].x-b[e].x)*(a.y-b[e].y)/(b[c].y-b[e].y)+b[e].x&&(d=!d);return d}},Ya=function(a,b,c){return!(a<b||a>c)};this.vector.isNumInRange=Ya;this.vector.point=g;this.vector.simplePoint=function(a,b,c){return{x:!1!==a?a:!1,y:!1!==b?b:!1,z:!1!==c?c:!1}};this.vector.v2d=g;this.vector.size=G;this.vector.getPointAngle=M;this.vector.isPointIn=
Ha;this.vector.pointMinus=function(a,b){return{x:a.x-b.x,y:a.y-b.y,z:a.z-b.z}};this.vector.pointPlus=ob;this.vector.pointInc=function(a,b){return{x:a.x*b.x,y:a.y*b.y,z:a.z*b.z}};this.vector.pointDiv=function(a,b){return{x:a.x/(0!==b.x?b.x:1),y:a.y/(0!==b.y?b.y:1),z:a.z/(0!==b.z?b.z:1)}};this.vector.pointAbs=function(a){return{x:Math.abs(a.x),y:Math.abs(a.y),z:Math.abs(a.z)}};this.vector.getMidPoint=function(a,b){return C(b)?g((a.x+b.x)/2,(a.y+b.y)/2):0};this.vector.getDistance=function(a,b){return Math.sqrt(Math.pow(b.x-
a.x,2)+Math.pow(b.y-a.y,2))};this.vector.isSame=function(a,b){return C(b)?a.x===b.x&&a.y===b.y:!1};this.vector.getAngle2Points=Xa;this.vector.newStaticBox=function(a,b,c,d){return{x:a,y:b,w:c,h:d}};this.vector.newDynamicBoxRect=function(a,b,c,d){return[g(a,b),g(a+c,b),g(a+c,b+d),g(a,b+d)]};this.vector.moveCollision=function(a,b,c,d,e,l){var n=!1,p=!1,u=c.abs(),B=a.getStaticBoxPosition(),N=b.length-1,W;var X=2+u.x;for(W=2+u.y;0<=N;N--)if(u=b[N],u.visible&&a!==u&&!(e&&!u.isInCameraStatic()||l&&a.getDistanceC(u.getPositionC())>
l)&&a.isStaticIntersect(u.getStaticBox())){var I=u.getStaticBoxPosition();B.h>=I.y+W&&B.y<=I.h-W&&(0<=c.x?Ya(B.w,I.x,I.w)&&(a.x=I.x-(a.w+a.box.w+a.box.x)+1,c.x=0,n=!0):0>c.x&&Ya(B.x,I.x,I.w)&&(a.x=I.w-a.box.x-1,c.x=0,n=!0));B.w>=I.x+X&&B.x<=I.w-X&&(0<c.y?Ya(B.h,I.y,I.h)&&(a.y=I.y-(a.h+a.box.h+a.box.y)+1,c.y=0,p=!0):0>c.y&&Ya(B.y,I.y,I.h)&&(a.y=I.h-a.box.y-1,c.y=0,p=!0));d&&d(a,u,n,p)}a.move(c)};this.vector.moveCollisionAngle=function(a,b,c,d,e,l,n){var p=g();e=math.a2r(OOP.isDef(e)?e:a.angle);p.x=
c*Math.cos(e);p.y=c*Math.sin(e);c=0;e=b.length;for(var u;c<e;c+=1)if(u=b[c],!l||u.isInCamera())if(!n||!a.getDistanceC(u.getPositionC())){var B=u.getStaticBox();if(a.isIntersect(u)){var N=a.getStaticBox(),W=Math.abs(p.x),X=Math.abs(p.y);N.x+N.w>B.x+10+W&&N.x<B.x+B.w-10-W&&(0<p.y&&N.y+N.h<B.y+B.h/2+X?p.y=0:0>p.y&&N.y>B.y+B.h-B.h/2-X&&(p.y=0));N.y+N.h>B.y+10+X&&N.y<B.y+B.h-10-X&&(0<p.x&&N.x+N.w<B.x+B.w/2+W?p.x=0:0>p.x&&N.x>B.x+B.w-B.w/2-W&&(p.x=0));d&&d(a,u)}}a.move(p);return p};var nc={},Sb=function(){var a=
(new Date).getTime();nc[a]&&(a=Sb());nc[a]=!0;return a},K=function(a){return Math.PI/180*a},fa=function(a,b,c){var d=Math.floor(Math.random()*(b-a+1)+a);return c&&0==d?fa(a,b,c):d},Ia=function(a,b){var c=(Ia.canvas||(Ia.canvas=document.createElement("canvas"))).getContext("2d");"number"==typeof b?c.font=b+"px serif":"string"==typeof b&&(c.font=b);return c.measureText(a).width},Tb=function(a){return 0>a?-1:1};this.math.limit=function(a,b){var c=Tb(a);a=Math.abs(a);b=Math.abs(b);return a<b?a*c:b*c};
this.math.sign=Tb;this.math.afterComma=function(a){return~(a+"").indexOf(".")?(a+"").split(".")[1].length:0};this.math.a2r=K;this.math.random=fa;this.math.randomFY=function(a){for(var b=a.length-1;0<b;b--){var c=Math.floor(Math.random()*(b+1)),d=a[b];a[b]=a[c];a[c]=d}return a};this.math.getTextWidth=Ia;this.math.toInt=function(a){return a>>0};this.math.uid=Sb;this.math.toZiro=function(a,b){if(0==a)return 0;var c=Tb(a);b=Math.abs(b);a=Math.abs(a);return 0<a&&(a-=b,a<b)?0:a*c};var oc=function(a,b){return a?
a:b?b:!1},Ub=[],Sc=function(a,b){var c;this.canvas=c=m.document.createElement("canvas");var d=c.style,e=w.style;d.position=Ca;d.top=e.top;d.left=e.left;c.width=w.width;c.height=w.height;d.width=e.width;d.height=e.height;d.zIndex=e.zIndex+a;b&&(d.opacity=oc(b.alpha,1),d.backgroundColor=oc(b.backgroundColor,"transparent"));t.attach(c);(this.context=c.getContext("2d")).textBaseline=z.textBaseline;this.isAutoClear=!0;this.clear=function(){this.context.clearRect(0,0,q,r)};this.on=function(l){k=this.context;
this.isAutoClear&&this.clear();l(this);k=pc};this.setVisible=function(l){};Ub.push(this)},Ja=function(){A(Ub,function(a){a.canvas.width=q;a.canvas.height=r;a.canvas.style.width=w.style.width;a.canvas.style.height=w.style.height;a.context.textBaseline=z.textBaseline})},Tc=function(){A(Ub,function(a){a.canvas.style.left=w.style.left;a.canvas.style.top=w.style.top})};this.layers.newLayer=function(a,b){return new Sc(a,b)};var qc=0,t={loaded:!0,events:{onload:[],preLoop:[],postLoop:[],entryLoop:[],exitLoop:[],
gameBlur:[],gameFocus:[],gameResize:[],gameStop:[],gameStart:[]},addEvent:function(a,b,c){"onload"===a&&t.loaded?c():t.events[a].push({id:b,func:c})},delEvent:function(a,b){A(t.events[a],function(c,d,e){c.id===b&&e.splice(d,1)})},runEvent:function(a){A(t.events[a],function(b){"function"===typeof b.func&&b.func()})},attach:function(a){var b=function(){m.document.body.appendChild(a)};t.loaded?b():t.addEvent("onload","attachElement_PointJS"+(qc+=1),b)},remove:function(a){var b=function(){m.document.body.removeChild(a)};
t.loaded?b():t.addEvent("onload","attachElement_PointJS"+(qc+=1),b)},getWH:function(){return{w:parseInt(m.innerWidth||m.document.body.clientWidth),h:parseInt(m.innerHeight||m.document.body.clientHeight)}}};this.system.delEvent=function(a,b){t.delEvent(a,b)};this.system.addEvent=function(a,b,c){t.addEvent(a,b,c)};this.system.removeDOM=function(a){t.remove(a)};this.system.attachDOM=function(a){t.attach(a)};this.system.newDOM=function(a,b){var c=m.document.createElement(a);c.style.position=Ca;c.style.left=
0;c.style.top=0;c.style.zIndex=x.style.zIndex+1;if(b){var d=function(e){e.stopPropagation()};c.addEventListener("touchstart",d,!1);c.addEventListener("touchend",d,!1);c.addEventListener("touchmove",d,!1);c.addEventListener("mousedown",d,!1);c.addEventListener("mousepress",d,!1);c.addEventListener("mouseup",d,!1);c.addEventListener("mousemove",d,!1);c.addEventListener("keypress",d,!1);c.addEventListener("keydown",d,!1);c.addEventListener("keyup",d,!1);c.addEventListener("click",d,!1);c.addEventListener("wheel",
d,!1);c.addEventListener("mousewheel",d,!1);c.addEventListener("contextmenu",d,!1);c.addEventListener("selectstart",d,!1);c.addEventListener("dragstart",d,!1);c.addEventListener("DOMMouseScroll",d,!1)}t.attach(c);return c};var k=null,pc=null,Za=g(kb,lb);var w=m.document.createElement("canvas");pc=k=w.getContext("2d");k.textBaseline=z.textBaseline;w.crossOrigin="anonymous";w.width=parseInt(R);w.height=parseInt(y);w.style.position=Ca;V?(w.style.left=Za.x+"px",w.style.top=Za.y+"px",t.addEvent("gameResize",
"initedCanvasResize",function(){var a=mb(V);F.system.setOffset(a.x,a.y);F.system.resize(V.offsetWidth,V.offsetHeight)})):(w.style.left=0,w.style.top=0);w.style.zIndex=na;w.id="PointJS-canvas_0";if("object"===typeof U)for(var Vb in U)Vb.match(/margin|padding|position/)||(w.style[Vb]=U[Vb]);this.system.setOffset=function(a,b){x.style.left=w.style.left=a+"px";x.style.top=w.style.top=b+"px";Za={x:a,y:b};Tc()};var x=m.document.createElement("div");(function(){var a=x.style;a.position=Ca;a.left=w.style.left;
a.top=w.style.top;a.width=w.width+"px";a.height=w.height+"px";a.zIndex=na+1})();t.attach(x);t.attach(w);this.system.setStyle=function(a){if("object"===typeof a)for(var b in a)w.style[b]=a[b]};this.system.getCanvas=function(){return w};this.system.getContext=function(){return k};this.system.setContext=function(a){a&&(k=a)};this.system.resize=function(a,b){q=a||Da;r=b||Ea;S=q/2;T=r/2;w.width=q;w.height=r;x.style.width=q+"px";x.style.height=r+"px";Ja()};var pb=!1;this.system.initFullPage=function(){V||
(pb=!0,t.addEvent("gameResize","PointJS_resizeGame",function(){q=t.getWH().w;r=t.getWH().h;S=q/2;T=r/2;w.width=q;w.height=r;k.textBaseline=z.textBaseline;x.style.width=q+"px";x.style.height=r+"px";Ja()}),t.runEvent("gameResize","PointJS_resizeGame"))};this.system.isFullPage=function(){return pb};var ma=!1,Uc=function(){ma||(this.requestFullscreen?(this.requestFullscreen(),ma=!0):this.mozRequestFullScreen?(this.mozRequestFullScreen(),ma=!0):this.webkitRequestFullscreen&&(this.webkitRequestFullscreen(),
ma=!0),q=t.getWH().w,r=t.getWH().h,S=q/2,T=r/2,w.width=q,w.height=r,x.style.width=q+"px",x.style.height=r+"px",Ja())},Wb=function(a){ma=rc(m.document.fullscreenElement||m.document.mozFullScreenElement||m.document.webkitFullscreenElement)};m.document.addEventListener("webkitfullscreenchange",Wb);m.document.addEventListener("mozfullscreenchange",Wb);m.document.addEventListener("fullscreenchange",Wb);this.system.initFullScreen=function(){V||ma||(m.document.documentElement.onclick=Uc,$a||(t.addEvent("gameResize",
"PointJS_initFullScreen",function(){q=t.getWH().w;r=t.getWH().h;S=q/2;T=r/2;w.width=q;w.height=r;k.textBaseline=z.textBaseline;x.style.width=q+"px";x.style.height=r+"px";Ja()}),t.runEvent("gameResize","PointJS_initFullScreen")))};this.system.exitFullScreen=function(){ma&&(t.delEvent("gameResize","PointJS_initFullScreen"),m.document.exitFullscreen?(m.document.exitFullscreen(),ma=!1):m.document.mozCancelFullScreen?(m.document.mozCancelFullScreen(),ma=!1):m.document.webkitExitFullscreen&&(m.document.webkitExitFullscreen(),
ma=!1),q=Da,r=Ea,S=q/2,T=r/2,w.width=q,w.height=r,x.style.width=q+"px",x.style.height=r+"px",Ja(),m.document.documentElement.onclick=function(){})};this.system.isFullScreen=function(){return ma};this.system.exitFullPage=function(){t.delEvent("gameResize","PointJS_resizeGame");q=Da;r=Ea;S=q/2;T=r/2;w.width=q;w.height=r;x.style.width=q+"px";x.style.height=r+"px";Ja()};var oa=!1,$a=!1,sc=Da,tc=Ea,uc=!1;this.system.initFullScale=function(a){V||$a||(a&&(uc=!0),t.addEvent("gameResize","PointJS_initFullScale",
function(){var b=sc,c=tc,d=t.getWH();uc?(b=d.w,c=d.h):d.w<d.h?(c=d.w/q,b=d.w,c*=r):d.h<d.w&&(b=d.h/r,c=d.h,b*=q);sc=b;tc=c;oa={w:b/q,h:c/r};w.style.width=b+"px";w.style.height=c+"px";x.style.width=b+"px";x.style.height=c+"px";Ja()}),t.runEvent("gameResize","PointJS_initFullScale"),$a=!0)};this.system.exitFullScale=function(){$a&&($a=!1,t.delEvent("gameResize","PointJS_initFullScale"),w.style.width=Da+"px",w.style.height=Ea+"px",x.style.width=Da+"px",x.style.height=Ea+"px")};this.system.getWH=function(){return t.getWH()};
var Xb=!1,qb={LEFT:37,RIGHT:39,UP:38,DOWN:40,SPACE:32,CTRL:17,SHIFT:16,ALT:18,ESC:27,ENTER:13,MINUS:189,PLUS:187,CAPS_LOCK:20,BACKSPACE:8,TAB:9,DELETE:46,Q:81,W:87,E:69,R:82,T:84,Y:89,U:85,I:73,O:79,P:80,A:65,S:83,D:68,F:70,G:71,H:72,J:74,K:75,L:76,Z:90,X:88,V:86,B:66,N:78,M:77,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,C:67,9:57,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123},Pa={37:"LEFT",39:"RIGHT",38:"UP",40:"DOWN",32:"SPACE",17:"CTRL",16:"SHIFT",18:"ALT",
27:"ESC",13:"ENTER",189:"MINUS",187:"PLUS",20:"CAPS_LOCK",8:"BACKSPACE",9:"TAB",46:"DELETE",81:"Q",87:"W",69:"E",82:"R",84:"T",89:"Y",85:"U",73:"I",79:"O",80:"P",65:"A",83:"S",68:"D",70:"F",71:"G",72:"H",74:"J",75:"K",76:"L",90:"Z",88:"X",86:"V",66:"B",78:"N",77:"M",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",67:"C",57:"9",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12"},Vc={8:!0,9:!0,13:!0,18:!0,16:!0,17:!0,27:!0,112:!0,
113:!0,114:!0,115:!0,116:!0,117:!0,118:!0,119:!0,120:!0,121:!0,122:!0,123:!0};this.keyControl.getKeyList=function(){var a,b=[];for(a in qb)b.push(a);return b};var pa={},ab={},Ka={},bb=!1,cb=!1,rb=!1,sb=!1,Wc=function(a){Q(Ka,function(b,c,d){1==b&&(d[c]=2)})};this.keyControl.getCountKeysDown=function(){var a=0;Q(pa,function(b,c){b&&a++});return a};this.keyControl.getAllKeysDown=function(){var a=[];Q(pa,function(b,c){b&&a.push(Pa[c])});return a};this.keyControl.getLastKeyPress=function(){return sb?
Pa[sb]:!1};this.keyControl.isDown=function(a){return 1==pa[qb[a]]};this.keyControl.isUp=function(a){return 1==ab[qb[a]]};this.keyControl.isPress=function(a){return 1==Ka[qb[a]]};this.keyControl.getInputChar=function(){return bb};this.keyControl.getInputKey=function(){return Pa[cb]};this.keyControl.setInputMode=function(a){rb=a};this.keyControl.isInputMode=function(){return rb};this.keyControl.exitKeyControl=function(){m.onkeydown=function(){};m.onkeypress=function(){};m.onkeyup=function(){};L.clear("key:down");
L.clear("key:press");L.clear("key:up");t.delEvent("postLoop","PointJS_clearAllKeyUp");t.delEvent("preLoop","PointJS_KeyDownEvent");pa={};ab={};Ka={};Xb=rb=cb=bb=!1};this.keyControl.initControl=this.keyControl.initKeyControl=function(){if(Xb)return this;Xb=!0;m.onkeydown=function(a){if(rb)return cb=a.keyCode,Vc[a.keyCode]?(a.preventDefault(),!1):!0;a.preventDefault();2!=Ka[a.keyCode]&&(Ka[a.keyCode]=1,sb=a.keyCode,L.run("key:press",Pa[a.keyCode]));pa[a.keyCode]=!0;return!1};m.onkeypress=function(a){var b=
!1;0!=a.which&&0!=a.charCode&&32<=a.which&&(b=String.fromCharCode(a.which));bb=b};m.onkeyup=function(a){a.preventDefault();1==pa[a.keyCode]&&(ab[a.keyCode]=!0);pa[a.keyCode]=!1;L.run("key:up",Pa[a.keyCode]);delete Ka[a.keyCode];delete pa[a.keyCode];return!1};t.addEvent("postLoop","PointJS_clearAllKeyUp",function(){ab={};Wc();sb=cb=bb=!1});t.addEvent("preLoop","PointJS_KeyDownEvent",function(){L.isEvent("key:down")&&Q(pa,function(a,b){a&&L.run("key:down",Pa[b])})});return this};var db=!1,D=g(0,0),
tb=g(0,0),Yb=g(0,0),eb=!0,Qa="",ub=!1,xa=g(0,0),fb=!1,Zb={LEFT:1,RIGHT:3,MIDDLE:2},$b={1:"LEFT",3:"RIGHT",2:"MIDDLE"},vb=!1,wb={},xb={},gb={},Ra=0,vc=function(){wb={};xb={};gb={};Ra=0;fb=!1},Xc=function(){Q(gb,function(a,b,c){1==a&&(c[b]=2)})},yb=function(a){var b=0,c=0;a&&(b=h.x,c=h.y);return g(b+D.x,c+D.y)};this.mouseControl.getPosition=function(){return yb(1)};this.mouseControl.getPositionS=function(){return yb()};this.mouseControl.setCursorImage=function(a,b){a="url("+a+"), auto";if(Qa!==a){Qa=
a;if(void 0===b||b)return m.document.body.style.cursor=Qa;if("undefined"!==typeof x&&"undefined"!=typeof x.style&&x.style)return x.style.cursor=Qa}};this.mouseControl.setStandardCursor=function(a,b){a=void 0===a?"default":a;Qa=null;if(void 0===b?0:b)return m.document.body.style.cursor=a;if("undefined"!==typeof x&&"undefined"!=typeof x.style&&x.style)return x.style.cursor=a};this.mouseControl.getVector=function(){var a=0,b=0;fb&&(a=0<Yb.x?1:-1,b=0<Yb.y?1:-1);return g(a,b)};this.mouseControl.setVisible=
function(a){!eb&&!a||eb&&a||(eb=1==a,m.document.body.style.cursor=eb?Qa:"none")};this.mouseControl.isVisible=function(){return eb};this.mouseControl.isDown=function(a){return wb[Zb[a]]};this.mouseControl.isUp=function(a){return xb[Zb[a]]};this.mouseControl.isPress=function(a){return 1==gb[Zb[a]]};this.mouseControl.isMove=function(){return fb};this.mouseControl.isInStatic=function(a){var b=yb(1);return b.x>=a.x&&b.x<=a.x+a.w&&b.y>=a.y&&b.y<=a.y+a.h};this.mouseControl.isInDynamic=function(a){return Ha(yb(1),
a)};this.mouseControl.isInObject=function(a){if(a.visible)return a.angle?this.isInDynamic(a.getDynamicBox()):this.isInStatic(a.getStaticBox())};this.mouseControl.isInObjectLevel=function(a){return a.angle?this.isInDynamic(a.getDynamicBox()):this.isInStatic(a.getStaticBox())};this.mouseControl.isWheel=function(a){return"UP"===a&&0<Ra||"DOWN"===a&&0>Ra};var wc=function(a){a.preventDefault();Ra=a.wheelDelta?a.wheelDelta:-a.detail;L.run("mouse:wheel",0>Ra?"DOWN":"UP");return!1},zb=!1,xc=function(){zb&&
(ub=C(m.document.pointerLockElement)||C(m.document.mozPointerLockElement)?!0:!1)};this.mouseControl.initMouseLock=function(){t.addEvent("onload","initPointerLock",function(){zb=x.requestPointerLock||x.mozRequestPointerLock||!1;m.document.exitPointerLock=m.document.exitPointerLock||m.document.mozExitPointerLock||!1;"onpointerlockchange"in m.document?m.document.addEventListener("pointerlockchange",xc,!1):"onmozpointerlockchange"in m.document&&m.document.addEventListener("mozpointerlockchange",xc,!1);
if(!zb)return ua("error in initMouseLock : not supported");ub||(x.onclick=zb)})};this.mouseControl.exitMouseLock=function(){m.document.exitPointerLock();x.onclick=function(){};xa=g(0,0)};this.mouseControl.unlockMouse=function(){xa=g(0,0);m.document.exitPointerLock()};this.mouseControl.isMouseLock=function(){return ub};this.mouseControl.getSpeed=function(){return g(xa.x,xa.y)};this.mouseControl.isPeekStatic=function(a,b){return this.isPress(a)?this.isInStatic(b):!1};this.mouseControl.isPeekDynamic=
function(a,b){return this.isPress(a)?this.isInDynamic(b):!1};this.mouseControl.isPeekObject=function(a,b){if(this.isPress(a)&&b.visible)return this.isInDynamic(b.getDynamicBox())};this.mouseControl.initControl=this.mouseControl.initMouseControl=function(){if(db)return this;db=!0;x.onmousemove=function(a){a.preventDefault();a.stopPropagation();if(ub){var b=a.movementY||a.mozMovementY||0;D.x+=a.movementX||a.mozMovementX||0;D.y+=b}else D.x=a.pageX-Za.x,D.y=a.pageY-Za.y,oa&&(D.x/=oa.w,D.y/=oa.h);D.x/=
Fa;D.y/=Ga;xa.x=D.x-tb.x;xa.y=D.y-tb.y;tb.x=D.x;tb.y=D.y;Yb=g(xa.x,xa.y);L.run("mouse:move");fb=!0;return!1};x.onmousedown=function(a){a.preventDefault();a.stopPropagation();!a.which&&a.button&&(a.button&1?a.which=1:a.button&4?a.which=2:a.button&2&&(a.which=3));L.run("mouse:press",$b[a.which]);vb=$b[a.which];wb[a.which]=!0;gb[a.which]=1};x.onmouseup=function(a){a.preventDefault();a.stopPropagation();!a.which&&a.button&&(a.button&1?a.which=1:a.button&4?a.which=2:a.button&2&&(a.which=3));L.run("mouse:up",
$b[a.which]);vb=!1;wb[a.which]=!1;xb[a.which]=!0;delete gb[a.which]};x.oncontextmenu=x.onselectstart=x.ondragstart=function(){return!1};x.onmousewheel=wc;x.addEventListener("DOMMouseScroll",wc,!1);t.addEvent("preLoop","PointJS_MouseEventDown",function(){vb&&L.run("mouse:down",vb)});t.addEvent("postLoop","PointJS_clearAllMouseUp",function(){xb={};Xc();Ra=0;fb=!1;xa=g(0,0)});return this};this.mouseControl.exitMouseControl=function(){L.clear("mouse:press");L.clear("mouse:down");L.clear("mouse:up");L.clear("mouse:move");
L.clear("mouse:wheel");x.onmousemove=x.onmousedown=x.onmouseup=x.oncontextmenu=x.onselectstart=x.ondragstart=x.onmousewheel=function(){};t.delEvent("postLoop","PointJS_clearAllMouseUp");t.delEvent("preLoop","PointJS_MouseEventDown");vc();db=!1};var ac=!1,hb=!1,Ab=0,Bb=0,aa=0,ba=0,H=g(0,0),Cb=[],ib=g(0,0),Db=g(0,0);this.touchControl.isTouchSupported=function(){return!!("ontouchstart"in window)};this.touchControl.isMobileDevice=function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(m.navigator.userAgent)};
var yc=function(){hb=!1;Bb=Ab=0;H=g(0,0);Cb=[];ba=aa=0};this.touchControl.getFixPositionS=function(){return H.x||H.y?g(H.x,H.y):!1};this.touchControl.getFixPosition=function(){return H.x||H.y?g(H.x+h.x,H.y+h.y):!1};this.touchControl.getRun=function(){var a=0,b=0;H.x&&H.x!=aa&&(a=aa-H.x);H.y&&H.y!=ba&&(b=ba-H.y);return g(a,b)};this.touchControl.getVector=function(){var a=0,b=0;H.x&&H.x!=aa&&(a=aa>H.x?1:-1);H.y&&H.y!=ba&&(b=ba>H.y?1:-1);return g(a,b)};this.touchControl.getSpeed=function(){return g(ib.x,
ib.y)};this.touchControl.isDown=function(){return hb};this.touchControl.isPress=function(){return 1==Ab};this.touchControl.isUp=function(){return 1==Bb};this.touchControl.getPosition=function(){return g(aa+h.x,ba+h.y)};this.touchControl.getPositionS=function(){return g(aa,ba)};this.touchControl.isPeekStatic=function(a){return this.isPress()?this.isInStatic(a):!1};this.touchControl.isPeekDynamic=function(a){return this.isPress()?this.isInDynamic(a):!1};this.touchControl.isPeekObject=function(a){if(this.isPress()&&
a.visible)return this.isInDynamic(a.getDynamicBox())};this.touchControl.isInStatic=function(a){var b=this.getPosition();return b.x>=a.x&&b.x<=a.x+a.w&&b.y>=a.y&&b.y<=a.y+a.h};this.touchControl.isInDynamic=function(a){return Ha(this.getPosition(),a)};this.touchControl.isInObject=function(a){if(a.visible)return a.angle?this.isInDynamic(a.getDynamicBox()):this.isInStatic(a.getStaticBox())};this.touchControl.getTouches=function(){return Cb};this.touchControl.initControl=this.touchControl.initTouchControl=
function(){if(ac)return this;ac=!0;m.addEventListener("touchstart",function(a){a.preventDefault();aa=a.targetTouches[0].pageX;ba=a.targetTouches[0].pageY;Cb=a.targetTouches;oa&&(aa/=oa.w,ba/=oa.h);L.run("touch:press");H.x=aa;H.y=ba;hb=!0;Ab=1;return!1},{passive:!1});m.addEventListener("touchmove",function(a){aa=a.targetTouches[0].pageX;ba=a.targetTouches[0].pageY;Cb=a.targetTouches;oa&&(aa/=oa.w,ba/=oa.h);ib.x=aa-Db.x;ib.y=ba-Db.y;L.run("touch:move");return!1},!1);m.addEventListener("touchend",function(a){H.x=
0;H.y=0;hb=!1;Bb=1;L.run("touch:up");return!1},!1);F.touchControl.vibrate=function(a){if(m.navigator.vibrate)return m.navigator.vibrate(a);if(m.navigator.oVibrate)return m.navigator.oVibrate(a);if(m.navigator.mozVibrate)return m.navigator.mozVibrate(a);if(m.navigator.webkitVibrate)return m.navigator.webkitVibrate(a)};t.addEvent("preLoop","PointJS_TouchDownEvent",function(){hb&&L.run("touch:down")});t.addEvent("postLoop","PointJS_touchStopPress",function(){Bb=Ab=0;Db.x=aa;Db.y=ba;ib=g(0,0)});return this};
this.touchControl.exitTouchControl=function(){m.ontouchstart=m.ontouchmove=m.ontouchend=function(a){};t.delEvent("postLoop","PointJS_touchStopPress");t.delEvent("preLoop","PointJS_TouchDownEvent");yc();ac=!1};var Eb=function(a,b,c,d){return d?"rgba("+a+", "+b+", "+c+", "+d+")":"rgb("+a+", "+b+", "+c+")"},zc=function(a,b){a="#"===a[0]?a.substr(1,6):a;var c=parseInt(a.substr(0,2),16),d=parseInt(a.substr(2,2),16),e=parseInt(a.substr(4,2),16);return Eb(c,d,e,b)};this.colors.rgb=function(a,b,c){return Eb(a,
b,c)};this.colors.rgba=function(a,b,c,d){return Eb(a,b,c,d)};this.colors.hex2rgb=function(a){return zc(a)};this.colors.hex2rgba=function(a,b){return zc(a,b)};this.colors.randomColor=function(a,b,c){return Eb(fa(a,b),fa(a,b),fa(a,b),c||1)};this.colors.fromImage=function(a,b,c,d,e){var l={img:m.document.createElement("img"),color:null};l.img.onload=function(){var n=m.document.createElement("canvas");n.width=d?d:this.width;n.height=e?e:this.height;n.getContext("2d").drawImage(this,0,0,n.width,n.height);
l.color=k.createPattern(n,b);"function"===typeof c&&(l.onload=c,l.onload(),delete l.onload)};l.img.src=a;return l};var C=function(a){return"undefined"==typeof a||null==a?!1:!0},rc=function(a){return C(a)&&""!==a&&0!==a?!0:!1},Q=function(a,b,c){var d,e;for(d in a)if((!c||a.hasOwnProperty(d))&&"undefined"!==typeof a[d]&&(e=b(a[d],d,a))&&"break"===e)break},A=function(a,b){if(a.length)for(var c=a.length-1,d;0<=c&&("undefined"===typeof a[c]||!(d=b(a[c],c,a)||!1)||"break"!==d);c--);};this.OOP.extractArrElement=
function(a,b){var c=a[b];a.splice(b,1);return c};this.OOP.extractRandArrElement=function(a){var b=fa(0,a.length-1),c=a[b];a.splice(b,1);return c};this.OOP.drawEach=function(a,b){Q(a,function(c){c&&c.draw&&c.isInCamera()&&(c.draw(),b&&b(c))})};this.OOP.drawArr=function(a,b){var c;var d=0;for(c=a.length;d<c;d+=1)a[d]&&a[d].draw&&a[d].isInCamera()&&(a[d].draw(),b&&b(a[d],d))};this.OOP.getArrInCamera=function(a){var b=[];A(a,function(c){c.isInCamera()&&b.push(c)});return b};this.OOP.getArrOutCamera=function(a){var b=
[];A(a,function(c){c.isInCamera()||b.push(c)});return b};var Ac=function(a){a.length=0},Yc=function(a,b){var c=!1,d=Sb(),e=!1,l=new XMLHttpRequest,n=function(){l.open("GET",a,!0);l.send()};l.onreadystatechange=function(){4==l.readyState&&(b(l.responseText),c&&(e?setTimeout(n,e):n()))};this.start=function(){a=a.match(/\?/)?a+("&session_id="+d):a+("?session_id="+d);n();c=!0};this.setSID=function(p){d=p};this.setTime=function(p){e=p};this.stop=function(){c=!1};this.isActive=function(){return c}};this.OOP.readJSON=
function(a,b,c){var d={},e=new XMLHttpRequest;e.open("GET",a,!0);J.add();e.onreadystatechange=function(){4==e.readyState&&(d=e.responseText,c||(d=JSON.parse(d)),J.load(),b(d))};e.send()};this.OOP.toString=function(a,b){var c,d=0,e="[";for(c in a)if(a.hasOwnProperty(c)){var l=a[c];"number"==typeof l&&b&&(l=parseInt(l));e+=(0<d?", ":"")+c+" : "+l;d+=1}return e+"]"};this.OOP.sendGET=function(a,b,c){var d=new XMLHttpRequest,e="?";Q(b,function(l,n){e+=n+"="+encodeURIComponent(l)+"&"});d.open("GET",a+e,
!0);d.onreadystatechange=function(){4==d.readyState&&c(d.responseText)};d.send()};this.OOP.sendPOST=function(a,b,c){var d=new XMLHttpRequest,e="";Q(b,function(l,n){e+=n+"="+encodeURIComponent(l)+"&"});d.open("POST",a,!0);d.setRequestHeader("Content-Type","application/x-www-form-urlencoded");d.onreadystatechange=function(){4==d.readyState&&c(d.responseText)};d.send(e)};this.OOP.sendPOSTScreen=function(a,b,c){var d=new XMLHttpRequest;b=b+"="+w.toDataURL("image/png");d.open("POST",a,!0);d.setRequestHeader("Content-Type",
"application/x-www-form-urlencoded");d.onreadystatechange=function(){4==d.readyState&&c(d.responseText)};d.send(b)};this.OOP.isDef=C;this.OOP.isSet=rc;this.OOP.forEach=Q;this.OOP.forInt=function(a,b){var c,d;for(c=0;c<a&&(!(d=b(c))||"break"!=d);c+=1);};this.OOP.forXY=function(a,b,c){var d,e,l;for(e=0;e<b;e+=1)for(d=0;d<a&&(!(l=c(d,e))||"break"!=l);d+=1);};this.OOP.forArr=A;this.OOP.clearArr=Ac;this.OOP.fillArr=function(a,b,c){a.length=0;var d;for(d=0;d<b;d+=1)a.push(c(d,0<d?a[d-1]:!1));return a};
this.OOP.delObject=function(a,b){var c;var d=0;for(c=a.length;d<c;d+=1)if(a[d]==b)return a.splice(d,1),!0};this.OOP.randArrElement=function(a){return a[fa(0,a.length-1)]};this.OOP.readJSONSync=function(a){var b=new XMLHttpRequest;b.open("GET",a,!1);b.send();a=b.responseText;return a=JSON.parse(a)};this.OOP.sendGETSync=function(a,b){var c=new XMLHttpRequest,d="?";Q(b,function(e,l){d+=l+"="+encodeURIComponent(e)+"&"});c.open("GET",a+d,!1);c.send();return c.responseText};this.OOP.sendPOSTSync=function(a,
b){var c=new XMLHttpRequest,d="";Q(b,function(e,l){d+=l+"="+encodeURIComponent(e)+"&"});c.open("POST",a,!1);c.setRequestHeader("Content-Type","application/x-www-form-urlencoded");c.send(d);return c.responseText};this.OOP.newAJAXListener=function(a,b){return new Yc(a,b)};this.OOP.runCode=function(a){(new Function("",a))()};var ca={};this.OOP.includeSync=function(a,b){if(ca[a])ca[a].loaded&&!b&&ca[a].code();else{ca[a]={loaded:!1,code:function(){console.log(a+" is loading")}};var c=new XMLHttpRequest;
c.open("GET",a,!1);c.send();ca[a].code=new Function("",c.responseText);ca[a].loaded=!0;ca[a].code()}};this.OOP.include=function(a,b,c){if(ca[a])ca[a].loaded&&!c&&ca[a].code(),b&&b();else{ca[a]={loaded:!1,code:function(){console.log(a+" is loading")}};var d=new XMLHttpRequest;d.open("GET",a,!0);d.onreadystatechange=function(){4===d.readyState&&(ca[a].code=new Function("",d.responseText),ca[a].loaded=!0,ca[a].code(),b&&b())};d.send()}};this.OOP.clone=function(a,b){var c=Bc(a);Q(a,function(d,e){-1===
["id","type","anim"].indexOf(e)&&(c[e]=d)});b&&(c.onClone=b,c.onClone(c),delete c.onClone);return c};var Zc=function(){var a=[];this.fillFromArr=function(b){a.length=0;A(b,function(c){a.push(c)})};this.fill=function(b,c){a.length=0;F.OOP.fillArr(a,b,c)};this.draw=function(b){for(var c=a.length-1;0<=c;c--)a[c].isInCamera()&&(a[c].draw(),b&&b(a[c],c))};this.update=function(b,c){for(var d=a.length-1;0<=d;d--)c&&!a[d].isInCamera()||b(a[d],d)};this.add=function(b){a.push(b)};this.del=function(b){F.OOP.delObject(a,
b)}};this.OOP.newGroup=function(){return new Zc};var jb=60,da=Date.now(),Fb=0,Gb=-1,Cc=da,za={},Hb=0;this.game.setFPS=function(a){jb=0<a?a:60};this.game.getDT=function(a){a||(a=1E3);return Fb/a};this.game.getTime=function(){return da};var Dc=function(){return m.requestAnimationFrame||m.webkitRequestAnimationFrame||m.mozRequestAnimationFrame||m.oRequestAnimationFrame||m.msRequestAnimationFrame||function(a){m.setTimeout(a,1E3/jb)}},Sa=Dc(),Ec=function(){da=Date.now();mc&&k.clearRect(0,0,q,r);t.runEvent("preLoop")},
Fc=function(){t.runEvent("postLoop");-1!==Gb&&(Fb=da-Gb);Gb=da},ea={func:function(){console.log('please, use a "setLoop" function.');Sa=function(){}},events:!1,start:!1,end:!1,audio:!1,fps:!1,name:"NotLoop"},Gc=function(){ea.audio&&A(ea.audio,function(a){a.stop()})};this.game.newLoop=function(a,b,c,d,e){"function"===typeof b?za[a]={events:e||!1,func:b,start:c||!1,end:d||!1,audio:!1,fps:!1,name:a}:Aa("error in newLoop : "+b+" is not a function")};this.game.newLoopFromClassObject=function(a,b){if(!b.update)return Aa('error in newLoopFromClassObject : function "update" not found');
za[a]={events:b.events||!1,func:b.update,start:b.entry||!1,end:b.exit||!1,audio:!1,fps:!1,name:a}};this.game.newLoopFromConstructor=function(a,b){F.game.newLoopFromClassObject(a,new b)};this.game.setLoopSound=function(a,b){var c;za[a].audio||(za[a].audio=[]);for(c=0;c<b.length;c+=1)za[a].audio.length=0,b[c].setNextPlay(b[c+1===b.length?0:c+1]),za[a].audio.push(b[c])};this.game.setLoop=function(a){if(!za[a])return Aa("setLoop : "+a+" is no a Loop");Gc();vc();pa={};ab={};Ka={};cb=bb=!1;yc();bc(g(0,
0));ea.end&&ea.end();t.runEvent("exitLoop");ea=za[a];L.loadFromEvents(ea.events);ea.start&&ea.start();t.runEvent("entryLoop");ea.audio&&ea.audio[0].play()};var L=new function(){var a={"mouse:click":[]},b=this;this.add=function(c,d){a[c]||(a[c]=[]);a[c].push(d)};this.run=function(c,d){a[c]&&A(a[c],function(e){return e(d)})};this.clear=function(c){a[c]&&(a[c].length=0)};this.clearAll=function(){Q(a,function(c){c.length=0})};this.loadFromEvents=function(c){b.clearAll();c&&Q(c,function(d,e){b.add(e,d)})};
this.isEvent=function(c){return!!a[c]}};this.game.tick=function(a,b){Hb===a&&b()};var Ib={};this.game.skip=function(a,b,c){C(Ib[a])||(Ib[a]=0);Ib[a]++>=b&&(c(),Ib[a]=0)};var cc=function(){60>Hb?Hb++:Hb=0;if(60>jb){var a=1E3/jb;try{da=Date.now(),da-Cc>a&&(Ec(),ea.func(Fb),Cc=da,Fc())}catch(b){Va&&nb(b),Rb&&(Va||nb(b),Aa())}Sa(cc);return!1}try{Ec(),ea.func(Fb),Fc()}catch(b){Va&&nb(b),Rb&&(Va||nb(b),Aa())}Sa(cc)},Hc=function(a){ya||(ya=!0,jb=a||60,Sa(cc),t.runEvent("gameStart"))},Aa=function(a){ya&&
(ya=!1,Gc(),Sa=function(){"undefined"!==typeof a&&ua(a)},t.runEvent("gameStop"))};this.game.isStopped=function(){return!ya};this.game.getWH=function(){return{w:q,h:r,w2:S,h2:T}};this.game.getWH2=function(){return{w:S,h:T}};this.game.getResolution=function(){return Math.min(q/Da,r/Ea)};this.game.startLoop=function(a,b){this.setLoop(a);this.start(b)};this.game.start=Hc;this.game.stop=Aa;this.game.resume=function(){if(!ya)return ea.audio&&ea.audio[0].play(),Sa=Dc(),Gb=-1,Hc(),!1};var $c=0,O=function(a){this.type=
"BaseObject";this.id=$c+=1;this.x=a.x||0;this.y=a.y||0;this.w=a.w||0;this.h=a.h||0;this.ondraw=a.ondraw?a.ondraw:!1;"function"===typeof a.predraw&&(this.predraw=a.predraw);this.parent=!1;this.children=[];this.fillColor=a.fillColor||!1;this.strokeColor=a.strokeColor||z.strokeStyle;this.strokeWidth=a.strokeWidth||0;this.angle=a.angle||0;this.alpha=C(a.alpha)?a.alpha:1;this.center=g(0,0);this.box={x:0,y:0,w:0,h:0};this.visible=C(a.visible)?a.visible:!0;this.flip=g(0,0);this.__dataset__={};this.setShadow(a);
"object"===typeof a.data&&Q(a.data,function(b,c){this.dataSet(c,b)},!0);a.userData&&this.setUserData(a.userData);a.center&&this.setCenter(a.center);a.box&&this.setBox(a.box);a.size&&this.setSize(a.size);a.sizeC&&this.setSizeC(a.sizeC);a.position&&this.setPosition(a.position);a.positionC&&this.setPositionC(a.positionC);"function"===typeof a.oncreate&&(this.oncreate=a.oncreate,this.oncreate(this),delete this.oncreate)};O.prototype={predraw:function(){},getID:function(){return this.id},getType:function(){return this.type},
dataDel:function(a){delete this.__dataset__[a]},dataSet:function(a,b){this.__dataset__[a]=b},dataGet:function(a,b){return"undefined"!==typeof this.__dataset__[a]?this.__dataset__[a]:"undefined"!==typeof b?b:!1},data:function(){return this.__dataset__},getParent:function(){return this.parent},addChild:function(a){a&&a.id!=this.id&&(a.parent=this,this.children.push(a),a.move(this.getPosition()),a.setPositionC(M(a.getPositionC(),this.getPositionC(),this.angle)),a.turn(this.angle))},delChild:function(a){a.parent=
!1;var b;var c=0;for(b=this.children.length;c<b;c+=1)if(this.children[c].id==a.id){this.children.splice(c,1);break}},delParent:function(){this.parent.delChild(this)},setBox:function(a){a.offset&&(this.box.x=a.offset.x||0,this.box.y=a.offset.y||0);a.size&&(this.box.w=a.size.w||0,this.box.h=a.size.h||0)},setStaticBox:function(a,b,c,d){this.box.x=a||0;this.box.y=b||0;this.box.w=c||0;this.box.h=d||0},isArrIntersect:function(a){var b;var c=0;for(b=a.length;c<b;c+=1)if(a[c].id!==this.id&&this.isIntersect(a[c]))return a[c];
return!1},isArrInside:function(a){if(this.visible){var b;var c=0;for(b=a.length;c<b;c+=1)if(this.isDynamicInside(a[c].getDynamicBox()))return a[c];return!1}},getNearest:function(a){var b=0,c=!1,d;var e=0;for(d=a.length;e<d;e+=1)if(this.id!==a[e].id){!1===c&&(c=this.getDistanceC(a[e].getPositionC()),b=e);var l=this.getDistanceC(a[e].getPositionC());l<c&&(c=l,b=e)}return a[b]},setFlip:function(a,b){C(a)&&this.flip.x!==a&&(this.flip.x=a);C(b)&&this.flip.y!==b&&(this.flip.y=b)},setUserData:function(a){for(var b in a)C(this[b])||
(this[b]=a[b])},setShadow:function(a){this.shadowColor=a.shadowColor||!1;this.shadowBlur=C(a.shadowBlur)?a.shadowBlur:3;this.shadowX=a.shadowX||0;this.shadowY=a.shadowY||0},getDynamicBox:function(){var a=this.getPosition(1);return 0===this.angle?[g(this.x+this.box.x,this.y+this.box.y),g(this.x+this.box.x+this.w+this.box.w,this.y+this.box.y),g(this.x+this.box.x+this.w+this.box.w,this.y+this.box.y+this.h+this.box.h),g(this.x+this.box.x,this.y+this.box.y+this.h+this.box.h)]:[M(g(this.x+this.box.x,this.y+
this.box.y),a,this.getAngle()),M(g(this.x+this.box.x+this.w+this.box.w,this.y+this.box.y),a,this.getAngle()),M(g(this.x+this.box.x+this.w+this.box.w,this.y+this.box.y+this.h+this.box.h),a,this.getAngle()),M(g(this.x+this.box.x,this.y+this.box.y+this.h+this.box.h),a,this.getAngle())]},isDynamicIntersect:function(a){if(this.visible){if(3>a.length)return!1;var b=this.getDynamicBox(),c;for(c=b.length-1;0<=c;c--)if(Ha(b[c],a))return!0;for(c=b.length-1;0<=c;c--)if(Ha(a[c],b))return!0;return!1}},isIntersect:function(a){if(a.visible)return this.angle||
a.angle?this.isDynamicIntersect(a.getDynamicBox()):this.isStaticIntersect(a.getStaticBox())},isDynamicInside:function(a){if(this.visible){if(3>a.length)return!1;var b=this.getDynamicBox(),c,d=0;var e=0;for(c=b.length;e<c;e+=1)Ha(b[e],a)&&(d+=1);return d===b.length?!0:!1}},drawDynamicBox:function(a){Z(this,1);k.shadowColor="transparent";ia(g(this.x+this.box.x,this.y+this.box.y),G(this.w+this.box.w,this.h+this.box.h),!1,a||"red",2);Jb(g(this.x+this.w/2+this.center.x,this.y+this.h/2+this.center.y),10,
a||"red");Y()},drawStaticBox:function(a){k.shadowColor="transparent";ia(g(this.x+this.box.x,this.y+this.box.y),G(this.w+this.box.w,this.h+this.box.h),!1,a||"yellow",2);Jb(g(this.x+this.w/2+this.center.x,this.y+this.h/2+this.center.y),10,a||"yellow")},drawStaticBoxA:function(a,b,c,d,e){k.shadowColor="transparent";ia(g(this.x+this.box.x-1+(a||0),this.y+this.box.y+2+(b||0)),G(this.w+this.box.w-1+(c||0),this.h+this.box.h-4+(d||0)),!1,e||"orange",1)},drawStaticBoxD:function(a,b,c,d,e){k.shadowColor="transparent";
ia(g(this.x+this.box.x+2+(a||0),this.y+this.box.y+2+(b||0)),G(this.w+this.box.w+(c||0),this.h+this.box.h-4+(d||0)),!1,e||"red",1)},drawStaticBoxW:function(a,b,c,d,e){k.shadowColor="transparent";ia(g(this.x+this.box.x+2+(a||0),this.y+this.box.y-2+(b||0)),G(this.w+this.box.w-4+(c||0),this.h+this.box.h+(d||0)),!1,e||"blue",1)},drawStaticBoxS:function(a,b,c,d,e){k.shadowColor="transparent";ia(g(this.x+this.box.x+2+(a||0),this.y+this.box.y+2+(b||0)),G(this.w+this.box.w-4+(c||0),this.h+this.box.h+(d||0)),
!1,e||"#329F93",1)},isStaticIntersect:function(a){if(this.visible)return this.y+this.box.y+this.h+this.box.h>=a.y&&this.x+this.box.x+this.w+this.box.w>=a.x&&this.x+this.box.x<a.x+a.w&&this.y+this.box.y<a.y+a.h},getStaticBoxPosition:function(){return{x:this.x+this.box.x,y:this.y+this.box.y,w:this.x+this.box.x+this.w+this.box.w,h:this.y+this.box.y+this.h+this.box.h}},getStaticBox:function(a,b,c,d){return{x:this.x+this.box.x+(a||0),y:this.y+this.box.y+(b||0),w:this.w+this.box.w+(2*c||0),h:this.h+this.box.h+
(2*d||0)}},getStaticBoxA:function(a,b,c,d){return{x:this.x+this.box.x-1+(a||0),y:this.y+this.box.y+2+(b||0),w:this.w+this.box.w-1+(c||0),h:this.h+this.box.h-4+(d||0)}},getStaticBoxD:function(a,b,c,d){return{x:this.x+this.box.x+2+(a||0),y:this.y+this.box.y+2+(b||0),w:this.w+this.box.w+(c||0),h:this.h+this.box.h-4+(d||0)}},getStaticBoxW:function(a,b,c,d){return{x:this.x+this.box.x+2+(a||0),y:this.y+this.box.y-2+(b||0),w:this.w+this.box.w-4+(c||0),h:this.h+this.box.h+(d||0)}},getStaticBoxS:function(a,
b,c,d){return{x:this.x+this.box.x+2+(a||0),y:this.y+this.box.y+2+(b||0),w:this.w+this.box.w-4+(c||0),h:this.h+this.box.h+(d||0)}},setAlpha:function(a){this.alpha!==a&&(this.alpha=0<=a?1>=a?a:1:0)},transparent:function(a){this.setAlpha(this.alpha+a)},getAlpha:function(){return this.alpha},rotate:function(a){this.setAngle(Math.atan2(a.y-this.getPosition(1).y,a.x-this.getPosition(1).x)*(180/Math.PI))},setCenter:function(a){this.center=g(a.x,a.y)},setCenter9points:function(a){switch(a){case 1:this.center=
g(-this.w/2+this.box.x,-this.h/2+this.box.y);break;case 2:this.center=g((this.box.x+this.box.w+this.box.x)/2,-this.h/2+this.box.y);break;case 3:this.center=g(this.w/2+this.box.w+this.box.x,-this.h/2+this.box.y);break;case 4:this.center=g(-this.w/2+this.box.x,(this.box.y+this.box.y+this.box.h)/2);break;case 5:this.center=g((this.box.x+this.box.w+this.box.x)/2,(this.box.y+this.box.y+this.box.h)/2);break;case 6:this.center=g(this.w/2+this.box.w+this.box.x,(this.box.y+this.box.y+this.box.h)/2);break;
case 7:this.center=g(-this.w/2+this.box.x,this.h/2+this.box.y+this.box.h);break;case 8:this.center=g((this.box.x+this.box.w+this.box.x)/2,this.h/2+this.box.y+this.box.h);break;case 9:this.center=g(this.w/2+this.box.w+this.box.x,this.h/2+this.box.y+this.box.h)}},nullCenter:function(a){a||(a=g(0,0));this.center=g(-this.w/2+a.x,-this.h/2+a.y)},getCenter:function(){return g(this.center.x,this.center.y)},getBox:function(){return this.box},move:function(a){this.x+=a.x;this.y+=a.y;this.y||(this.x=this.x)},
circling:function(a,b,c){C(this.circlingAnglePointJS)||(this.circlingAnglePointJS=0);this.x=a.x+b*Math.cos(K(this.circlingAnglePointJS));this.y=a.y+b*Math.sin(K(this.circlingAnglePointJS));this.circlingAnglePointJS=360<this.circlingAnglePointJS?0:this.circlingAnglePointJS+c},circlingC:function(a,b,c){C(this.circlingAnglePointJS)||(this.circlingAnglePointJS=0);this.setPositionC(g(a.x+b*Math.cos(K(this.circlingAnglePointJS)),a.y+b*Math.sin(K(this.circlingAnglePointJS))));this.circlingAnglePointJS=360<
this.circlingAnglePointJS?0:this.circlingAnglePointJS+c},motion:function(a,b,c){C(this.motionPercentPointJS)||(this.motionPercentPointJS=0);this.x=a.x+b.w*Math.cos(K(this.motionPercentPointJS));this.y=a.y+b.h*Math.sin(K(this.motionPercentPointJS));this.motionPercentPointJS=360<this.motionPercentPointJS?0:this.motionPercentPointJS+c},motionC:function(a,b,c){C(this.motionPercentPointJS)||(this.motionPercentPointJS=0);this.setPositionC(g(a.x+b.w*Math.cos(K(this.motionPercentPointJS)),a.y+b.h*Math.sin(K(this.motionPercentPointJS))));
this.motionPercentPointJS=360<this.motionPercentPointJS?0:this.motionPercentPointJS+c},scale:function(a){this.w*=a;this.h*=a},scaleC:function(a){var b=this.w,c=this.h;this.scale(a);this.move(g(-((this.w-b)/2),-((this.h-c)/2)))},getPosition:function(a){return 1===a?g(this.x+(this.w/2+this.center.x),this.y+(this.h/2+this.center.y)):2===a?(a=g(this.x+this.w/2,this.y+this.h/2),this.angle&&(a=M(a,this.getPosition(1),this.angle)),g(a.x,a.y)):g(this.x,this.y)},getPositionC:function(){return g(this.x+(this.w/
2+this.center.x),this.y+(this.h/2+this.center.y))},getPositionS:function(){return g(this.x+h.x,this.y+h.x)},getPositionCS:function(){return g(this.x+(this.w/2+this.center.x)+h.x,this.y+(this.h/2+this.center.y)+h.y)},setPosition:function(a){!1!==a.x&&(this.x=a.x);!1!==a.y&&(this.y=a.y)},setPositionS:function(a){!1!==a.x&&(this.x=a.x+h.x);!1!==a.y&&(this.y=a.y+h.y)},setPositionC:function(a){!1!==a.x&&(this.x=-(this.w/2+this.center.x)+a.x);!1!==a.y&&(this.y=-(this.h/2+this.center.y)+a.y)},setPositionCS:function(a){!1!==
a.x&&(this.x=-(this.w/2+this.center.x)+a.x+h.x);!1!==a.y&&(this.y=-(this.h/2+this.center.y)+a.y+h.y)},getSize:function(){return G(this.w,this.h)},setSize:function(a){this.w=a.w;this.h=a.h},setSizeC:function(a){var b=this.w,c=this.h;this.w=a.w;this.h=a.h;this.move(g(-((this.w-b)/2),-((this.h-c)/2)))},turn:function(a){this.angle+=a},rotateForAngle:function(a,b){0>this.angle&&(this.angle+=360);0>a&&(a+=360);var c=this.angle-a;180<c?c-=360:-180>c&&(c+=360);c>=-b-.5&&c<=b+.5?this.angle=a:c>b+.5?this.angle-=
b:c<-b-.5&&(this.angle+=b)},rotateForPoint:function(a,b){var c=Xa(this.getPositionC(),a);this.rotateForAngle(c,b)},rotateForObject:function(a,b){var c=Xa(this.getPositionC(),a.getPositionC());this.rotateForAngle(c,b)},moveTo:function(a,b,c){a=K(Xa(this.getPosition(),a));this.x+=b*Math.cos(a);c?this.y+=c*Math.sin(a):this.y+=b*Math.sin(a)},moveToC:function(a,b,c){a=K(Xa(this.getPositionC(),a));this.x+=b*Math.cos(a);c?this.y+=c*Math.sin(a):this.y+=b*Math.sin(a)},moveAngle:function(a,b){b=K(C(b)?b:this.angle);
this.x+=a*Math.cos(b);this.y+=a*Math.sin(b)},moveTime:function(a,b){b=b||1;var c=this.getPosition();this.move(g((a.x-c.x)/b,(a.y-c.y)/b))},moveTimeC:function(a,b){b=b||1;var c=this.getPosition(1);this.move(g((a.x-c.x)/b,(a.y-c.y)/b))},getAngle:function(){return this.angle},setAngle:function(a){this.angle!==a&&(this.angle=a%360)},getDistance:function(a){return Math.sqrt(Math.pow(a.x-this.getPosition(2).x,2)+Math.pow(a.y-this.getPosition(2).y,2))},getDistanceC:function(a){return Math.sqrt(Math.pow(a.x-
this.getPosition(1).x,2)+Math.pow(a.y-this.getPosition(1).y,2))},setVisible:function(a){this.visible=!0===a},isVisible:function(){return this.visible},isInCamera:function(){return this.angle?this.isInCameraDynamic():this.isInCameraStatic()},isInCameraStatic:function(){return this.x+this.w<h.x||this.x>h.x+q||this.y+this.h<h.y||this.y>h.y+r?!1:!0},isInCameraDynamic:function(){var a=this.getDynamicBox(),b=[g(h.x,h.y),g(h.x+q,h.y),g(h.x+q,h.y+r),g(h.x,h.y+r)],c,d=0;var e=0;for(c=a.length;e<c;e+=1)Ha(a[e],
b)&&(d+=1);return 0<d},draw:function(){}};this.game.newBaseObject=function(a){return new O(a)};var Kb=function(a){O.call(this,a);this.type="TriangleObject";this.alpha=a.alpha||1};va(O,Kb);Kb.prototype.getDynamicBox=function(){var a=this.getPositionC();return 0===this.angle?[g(this.x+this.w/2,this.y),g(this.x+this.w,this.y+this.h),g(this.x,this.y+this.h)]:[M(g(this.x+this.w/2,this.y),a,this.getAngle()),M(g(this.x+this.w,this.y+this.h),a,this.getAngle()),M(g(this.x,this.y+this.h),a,this.getAngle())]};
Kb.prototype.draw=function(){this.predraw();if(k.globalAlpha=this.alpha){var a=!1;if(this.angle||1!==this.alpha||this.shadowColor)Z(this),a=!0;La(this.x,this.y,[g(this.w/2,0),g(this.w,this.h),g(0,this.h)],this.fillColor,this.strokeWidth?this.strokeColor:!1,this.strokeWidth);if(this.ondraw)this.ondraw();a&&Y()}};this.game.newTriangleObject=function(a){return new Kb(a)};this.game.newRectObject=function(a){return new Lb(a)};var Lb=function(a){O.call(this,a);this.type="RectObject"};va(O,Lb);Lb.prototype.draw=
function(){this.predraw();if(this.alpha){var a=!1;if(this.angle||1!==this.alpha||this.shadowColor)Z(this),a=!0;ia(g(this.x,this.y),G(this.w,this.h),this.fillColor,this.strokeColor,this.strokeWidth,this.alpha);if(this.ondraw)this.ondraw();a&&Y()}};this.game.newRectObject=function(a){return new Lb(a)};var dc=function(a){O.call(this,a);this.type="RoundRectObject";this.radius=a.radius||1};va(O,dc);dc.prototype.draw=function(){this.predraw();if(this.alpha){var a=!1;if(this.angle||1!==this.alpha||this.shadowColor)Z(this),
a=!0;Mb(g(this.x,this.y),G(this.w,this.h),this.radius,this.fillColor,this.strokeColor,this.strokeWidth,this.alpha);if(this.ondraw)this.ondraw();a&&Y()}};this.game.newRoundRectObject=function(a){return new dc(a)};var Ba=function(a){O.call(this,a);this.radius=a.radius||5;a.scale&&(this.radius*=a.scale);this.w=2*this.radius;this.h=2*this.radius;this.type="CircleObject";a.positionC&&this.setPositionC(a.positionC)};va(O,Ba);Ba.prototype.draw=function(){this.predraw();if(!this.alpha)return this.ondraw?
this.ondraw():null;var a=!1;if(this.angle||1!==this.alpha||this.shadowColor)Z(this),a=!0;Ta(g(this.x,this.y),this.radius,this.fillColor,this.strokeColor,this.strokeWidth,this.alpha);if(this.ondraw)this.ondraw();a&&Y()};Ba.prototype.scale=function(a){this.w*=a||0;this.h*=a||0;this.radius*=a};Ba.prototype.scaleC=function(a){var b=this.w,c=this.h;this.w*=a||0;this.h*=a||0;this.radius*=a;this.move(g(-((this.w-b)/2),-((this.h-c)/2)))};Ba.prototype.getRadius=function(){return this.radius};Ba.prototype.setRadius=
function(a){a&&this.radius!==a&&(1>a&&(a=1,console.log("\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435! \u0420\u0430\u0434\u0438\u0443\u0441 \u043e\u043a\u0440\u0443\u0436\u043d\u043e\u0441\u0442\u0438 \u043d\u0435 \u043c\u043e\u0436\u0435\u0442 \u0440\u0430\u0432\u043d\u044f\u0442\u044c\u0441\u044f \u043d\u0443\u043b\u044e \u0438\u043b\u0438 \u0431\u044b\u0442\u044c \u043e\u0442\u0440\u0438\u0446\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u043c")),this.radius=a,this.w=2*a,this.h=2*a)};Ba.prototype.setRadiusC=
function(a,b,c){if(a&&this.radius!==a){1>a&&(a=1,console.log("\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435! \u0420\u0430\u0434\u0438\u0443\u0441 \u043e\u043a\u0440\u0443\u0436\u043d\u043e\u0441\u0442\u0438 \u043d\u0435 \u043c\u043e\u0436\u0435\u0442 \u0440\u0430\u0432\u043d\u044f\u0442\u044c\u0441\u044f \u043d\u0443\u043b\u044e \u0438\u043b\u0438 \u0431\u044b\u0442\u044c \u043e\u0442\u0440\u0438\u0446\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u043c"));var d=this.w,e=this.h;this.radius=a;this.w=
2*a;this.h=2*a;this.move(g(-((this.w-d+(b||0))/2),-((this.h-e+(c||0))/2)))}};this.game.newCircleObject=function(a){return new Ba(a)};var ec=function(a){this.file=a.file;this.w=a.w;this.h=a.h;this.alpha=a.alpha||1;this.read={x:0,y:0,w:0,h:0};a.read&&(this.read.w=a.read.w||0,this.read.h=a.read.h||0,this.read.x=a.read.x||0,this.read.y=a.read.y||0);this.countX=a.countX;this.countY=a.countY;this.fullW=this.countX*this.w;this.fullH=this.countY*this.h;this.cnv=m.document.createElement("canvas");this.cnv.width=
this.w;this.cnv.height=this.h;this.ctx=this.cnv.getContext("2d");this.loaded=!1;this.x=a.x||0;this.y=a.y||0;a=m.document.createElement("img");var b=this;a.onload=function(){b.ctx.drawImage(this,b.read.x?b.read.x:0,b.read.y?b.read.y:0,b.read.w?b.read.w:this.width,b.read.h?b.read.h:this.height,0,0,b.w,b.h);b.loaded=!0;J.load()};a.src=this.file;J.add()};ec.prototype.draw=function(a){if(this.loaded){a=-h.x+this.x;var b=-h.y+this.y,c=Math.trunc((q+Math.abs(h.x))/this.w+2),d=Math.trunc((r+Math.abs(h.y))/
this.h+2);if(!0===pb){var e=Math.trunc(q/this.w/2),l=Math.trunc(Math.abs(h.x/this.w));l=l<e?e:l;0>h.x&&(e=l=0);var n=Math.trunc(r/this.h/2);var p=Math.trunc(Math.abs(h.y/this.h));p=p<n?n:p;0>h.y&&(n=p=0)}!1===pb&&(this.countY<d&&(d=this.countY),this.countX<c&&(c=this.countX),l=p=e=n=0);for(p=0+p-n;p<d;p++)for(n=0+l-e;n<c;n++)k.drawImage(this.cnv,a+n*this.w,b+p*this.h,this.w,this.h)}};ec.prototype.getSize=function(){return this.loaded?G(this.fullW,this.fullH):G()};this.game.newBackgroundObject=function(a){return new ec(a)};
var fc=function(a){O.call(this,a);this.type="EllipseObject"};va(O,fc);fc.prototype.draw=function(){this.predraw();if(this.alpha){Z(this);Ta(g(this.x,this.y),this.h/2,this.fillColor,this.strokeColor,this.strokeWidth,this.alpha);if(this.ondraw)this.ondraw();Y()}};this.game.newEllipseObject=function(a){return new fc(a)};var qa=function(a){O.call(this,a);this.type="TextObject";this.text=a.text||"TextObject";this.color=a.color||"";this.size=0<a.size?a.size:10;a.scale&&(this.size*=a.scale);this.font=a.font||
"serif";this.style=a.style||"";this.align="left";this.valign="top";this.radius=a.radius||0;this.padding=a.padding||0;this.w=Ia(this.text,this.style,this.size,this.font)+2*this.padding;this.h=this.size+2*this.padding;this.strokeColorText=a.strokeColorText||"000000";this.strokeWidthText=a.strokeWidthText||0;this.textDY=-this.size/11;a.positionC&&this.setPositionC(a.positionC)};va(O,qa);qa.prototype.reStyle=function(a){this.text=a.text||this.text;this.color=a.color||this.color;this.size=a.size||this.size;
this.font=a.font||this.font;this.style=a.style||this.style;this.padding=Number(a.padding||this.padding);this.w=Ia(this.text,this.style,this.size,this.font)+2*this.padding;this.h=this.size+2*this.padding;this.strokeColorText=a.strokeColorText||this.strokeColorText;this.strokeWidthText=Number(a.strokeWidthText||this.strokeWidthText);this.strokeColor=a.strokeColor||this.strokeColor;this.strokeWidth=Number(a.strokeWidth||this.strokeWidth);this.fillColor=a.fillColor||this.fillColor;this.textDY=-this.size/
11};qa.prototype.setText=function(a){this.text!==a&&this.reStyle({text:a})};qa.prototype.getText=function(){return this.text};qa.prototype.draw=function(){this.predraw();if(this.alpha){var a=!1;if(this.angle||1!==this.alpha||this.shadowColor)Z(this),a=!0;if(this.fillColor||this.strokeColor)this.radius?Mb(g(this.x,this.y),G(this.w,this.h),this.radius,this.fillColor,this.strokeColor,this.strokeWidth,this.alpha):ia(g(this.x,this.y),G(this.w,this.h),this.fillColor,this.strokeColor,this.strokeWidth,this.alpha);
Ma(g(this.x+this.padding,this.textDY+this.y+this.padding),this.text,this.color,this.size,this.font,this.style,this.align,this.strokeColorText,this.strokeWidthText);if(this.ondraw)this.ondraw();a&&Y()}};qa.prototype.scale=function(a){this.reStyle({size:this.size*a})};qa.prototype.scaleC=function(a){var b=this.w,c=this.h;this.reStyle({size:this.size*a});this.move(g(-((this.w-b)/2),-((this.h-c)/2)))};qa.prototype.setSize=function(a){this.size!==a&&this.reStyle({size:a})};qa.prototype.setSizeC=function(a){this.size!==
a&&(this.reStyle({size:a}),this.move(g(-a/2,-a/2)))};Ia=function(a,b,c,d){var e=m.document.createElement("canvas").getContext("2d");e.font=(b?b+" ":"")+c+"px "+d;return e.measureText(a).width};this.OOP.getTextWidth=function(a){return Ia(a.text,a.style||"",a.size||10,a.font||"serif")};this.game.newTextObject=function(a){return new qa(a)};var ha=function(a){O.call(this,a);this.type="PolygonObject";this.points=[];this.pointColor=a.pointColor||!1;this.w=this.h=0;var b=this;"undefined"!==typeof a.points&&
A(a.points,function(c){b.addPoint(c)})};va(O,ha);ha.prototype.addPoint=function(a){this.points.push(a);a.x>this.w&&(this.w=a.x);a.x>this.h&&(this.h=a.x)};ha.prototype.addPointPlace=function(a,b){this.points.splice(b,0,a);a.x>this.w&&(this.w=a.x);a.x>this.h&&(this.h=a.x)};ha.prototype.delPoint=function(a){this.points.splice(a,1)};ha.prototype.clearPoints=function(){this.points.length=0};ha.prototype.getPoints=function(){return this.points};ha.prototype.getCount=function(){return this.points.length};
ha.prototype.getPoint=function(a){return this.points[a]};ha.prototype.isIntersect=function(a){if(a.visible)return this.isDynamicIntersect(a.getDynamicBox())};ha.prototype.drawDynamicBox=function(a){La(this.x,this.y,this.points,!1,"yellow",1,"red",this.alpha)};ha.prototype.getDynamicBox=function(){for(var a=[],b=this.points.length-1;0<=b;b--)a.push(M(this.points[b],g(this.w/2+this.center.x,this.h/2+this.center.y),this.angle).plus(g(this.x,this.y)));return a};ha.prototype.draw=function(){this.predraw();
if(this.alpha){var a=!1;if(this.angle||1!==this.alpha||this.shadowColor)Z(this),a=!0;La(this.x,this.y,this.points,this.fillColor,this.strokeColor,this.strokeWidth,this.pointColor,this.alpha);if(this.ondraw)this.ondraw();a&&Y()}};this.game.newPolygonObject=function(a){return new ha(a)};var P=function(a){O.call(this,a);var b=this;this.points=[];this.pointFillColor=a.pointFillColor||"#e4131360";this.pointStrokeColor=a.pointStrokeColor||"black";this.pointStrokeWidth=a.pointStrokeWidth||1;this.pointColor=
a.pointColor||"white";this.type="ImageObject";this.loaded=!1;this.file="";this.forOnLoad=a.onload||!1;Ic(a.file,this,a.scale||1);"undefined"!==typeof a.points&&A(a.points,function(c){b.addPoint(c)})};va(O,P);P.prototype.addPoint=function(a){this.points.push(a)};P.prototype.addPointPlace=function(a,b){this.points.splice(b,0,a)};P.prototype.delPoint=function(a){this.points.splice(a,1)};P.prototype.clearPoints=function(){this.points.length=0};P.prototype.getPoints=function(){for(var a=[],b=this.points.length-
1;0<=b;b--)a.push(M(this.points[b],g(this.w/2+this.center.x,this.h/2+this.center.y),this.angle).plus(g(this.x,this.y)));return a};P.prototype.delPoint=function(a){this.points.splice(a,1)};P.prototype.clearPoints=function(){this.points.length=0};P.prototype.getPoints=function(){return this.points};P.prototype.getCount=function(){return this.points.length};P.prototype.getPoint=function(a){return this.points[a]};P.prototype.isIntersect=function(a){if(a.visible)return this.isDynamicIntersect(a.getDynamicBox())};
P.prototype.getDynamicBoxPoint=function(){if(0<this.points.length){for(var a=[],b=this.points.length-1;0<=b;b--)a.push(M(this.points[b],g(this.w/2+this.center.x,this.h/2+this.center.y),this.angle).plus(g(this.x,this.y)));return a}};P.prototype.drawPoints=function(){if(0!==this.points.length&&this.loaded){var a=!1;if(this.angle||1!==this.alpha||this.shadowColor||this.flip.x||this.flip.y)Z(this),a=!0;La(this.x,this.y,this.points,this.pointFillColor,this.pointStrokeColor,this.pointStrokeWidth,this.pointColor);
if(this.ondraw)this.ondraw();a&&Y()}};P.prototype.draw=function(){this.predraw();if(this.alpha&&this.loaded){var a=!1;if(this.angle||1!==this.alpha||this.shadowColor||this.flip.x||this.flip.y)Z(this),a=!0;Jc(g(this.x,this.y),G(this.w,this.h),this.file,this.alpha);if(this.ondraw)this.ondraw();a&&Y()}};P.prototype.simpleDraw=function(a){this.predraw();if(this.loaded){var b=!1;if(this.angle||1!==this.alpha||this.shadowColor)Z(this),b=!0;Jc(g(a.x,a.y),G(this.w,this.h),this.file,this.alpha);b&&Y()}};P.prototype.setImage=
function(a,b){this.file!==a&&(C(v[a])?(this.file=a,b&&b()):(this.loaded=!1,this.origHeight=this.origWidth=0,this.forOnLoad=b||!1,Ic(a,this)))};P.prototype.getImage=function(){return this.file};P.prototype.resize=function(a){if(!1!==a.w&&!1===a.h){var b=a.w/this.w;this.w=a.w;this.h*=b}else!1!==a.h&&!1===a.w?(b=a.h/this.h,this.h=a.h,this.w*=b):!1!==a.w&&!1!==a.h&&(this.w=a.w,this.h=a.h)};this.game.newImageObject=function(a){return new P(a)};var E=function(a){var b=this;O.call(this,a);this.type="AnimationObject";
this.countFrame=a.frames||10;this.startFrame=a.startFrame||void 0;this.frame=a.frame||0;this.anim=a.animation;this.step=a.delay||10;this.toFrameStep=this.difStep=0;this.points=[];this.pointFillColor=a.pointFillColor||"#e4131360";this.pointStrokeColor=a.pointStrokeColor||"black";this.pointStrokeWidth=a.pointStrokeWidth||1;this.pointColor=a.pointColor||"white";"undefined"!==typeof a.points&&A(a.points,function(c){b.addPoint(c)});a.scale&&(this.w*=a.scale,this.h*=a.scale);void 0==this.startFrame?this.frame=
pjs.math.random(0,this.countFrame,!1):this.frame=this.startFrame};va(O,E);E.prototype.addPoint=function(a){this.points.push(a)};E.prototype.addPointPlace=function(a,b){this.points.splice(b,0,a)};E.prototype.delPoint=function(a){this.points.splice(a,1)};E.prototype.clearPoints=function(){this.points.length=0};E.prototype.getPoints=function(){for(var a=[],b=this.points.length-1;0<=b;b--)a.push(M(this.points[b],g(this.w/2+this.center.x,this.h/2+this.center.y),this.angle).plus(g(this.x,this.y)));return a};
E.prototype.delPoint=function(a){this.points.splice(a,1)};E.prototype.clearPoints=function(){this.points.length=0};E.prototype.getPoints=function(){return this.points};E.prototype.getCount=function(){return this.points.length};E.prototype.getPoint=function(a){return this.points[a]};E.prototype.getDynamicBoxPoint=function(){if(0<this.points.length){for(var a=[],b=this.points.length-1;0<=b;b--)a.push(M(this.points[b],g(this.w/2+this.center.x,this.h/2+this.center.y),this.angle).plus(g(this.x,this.y)));
return a}};E.prototype.drawPoints=function(){if(0!==this.points.length){var a=!1;if(this.angle||1!==this.alpha||this.shadowColor||this.flip.x||this.flip.y)Z(this),a=!0;La(this.x,this.y,this.points,this.pointFillColor,this.pointStrokeColor,this.pointStrokeWidth,this.pointColor);if(this.ondraw)this.ondraw();a&&Y()}};E.prototype.draw=function(){if(this.alpha){var a=!1;if(this.angle||1!==this.alpha||this.flip.x||this.flip.y||this.shadowColor)Z(this),a=!0;gc(this.anim,g(this.x,this.y),G(this.w,this.h),
this.frame,this.alpha);if(this.ondraw)this.ondraw();this.difStep>this.step?(this.frame=this.frame<this.anim.r?this.frame+1:0,this.difStep=0):this.difStep+=1;a&&Y()}};E.prototype.drawFrames=function(a,b,c){if(this.alpha){if(this.frame<a||this.frame>b)this.frame=a;c=!1;if(this.angle||1!==this.alpha||this.flip.x||this.flip.y||this.shadowColor)Z(this),c=!0;gc(this.anim,g(this.x,this.y),G(this.w,this.h),this.frame,this.alpha);if(this.ondraw)this.ondraw();this.difStep>this.step?(this.frame=this.frame<b?
this.frame+1:a,this.difStep=0):this.difStep+=1;c&&Y()}};E.prototype.drawFrame=function(a){if(this.alpha){var b=!1;if(this.angle||1!==this.alpha||this.flip.x||this.flip.y||this.shadowColor)Z(this),b=!0;gc(this.anim,g(this.x,this.y),G(this.w,this.h),a,this.alpha);if(this.ondraw)this.ondraw();b&&Y()}};E.prototype.drawToFrame=function(a){if(this.alpha)if(this.frame<a){this.toFrameStep=1;this.drawFrame(this.frame);if(this.ondraw)this.ondraw();this.difStep>this.step?(this.frame+=this.toFrameStep,this.difStep=
0):this.difStep+=1}else this.drawFrame(a)};E.prototype.drawToReversFrame=function(a){if(this.alpha)if(this.frame>a){this.toFrameStep=-1;this.drawFrame(this.frame);if(this.ondraw)this.ondraw();this.difStep>this.step?(this.frame+=this.toFrameStep,this.difStep=0):this.difStep+=1}else this.drawFrame(a)};E.prototype.drawReversFrames=function(a,b){if(this.alpha){this.drawFrame(this.frame);if(this.ondraw)this.ondraw();this.difStep>this.step?(this.frame<=a?this.toFrameStep=1:this.frame>=b&&(this.toFrameStep=
-1),this.frame+=this.toFrameStep,this.difStep=0):this.difStep+=1}};E.prototype.setAnimation=function(a){a!==this.anim&&(this.frame=0,this.anim=a)};E.prototype.getAnimation=function(){return this.anim};E.prototype.setDelay=function(a){this.step=0<a?a:this.step};E.prototype.getDelay=function(){return this.step};E.prototype.getFrame=function(){return this.frame};E.prototype.setFrame=function(a){this.frame=a};E.prototype.setStartFrame=function(a){this.startFrame=a};E.prototype.getLastFrame=function(){return this.anim.endFrame};
this.game.newAnimationObject=function(a){return new E(a)};var Bc=function(a){var b=!1;"RectObject"===a.type?b=F.game.newRectObject({}):"CircleObject"===a.type?b=F.game.newCircleObject({}):"RoundRectObject"===a.type?b=F.game.newRoundRectObject({}):"TextObject"===a.type?b=F.game.newTextObject({}):"EllipseObject"===a.type?b=F.game.newEllipseObject({}):"ImageObject"===a.type?b=F.game.newImageObject({file:a.file}):"TriangleObject"===a.type?b=F.game.newTriangleObject({}):"PolygonObject"===a.type?b=F.game.newTriangleObject({points:a.points}):
"AnimationObject"===a.type&&(b=F.game.newAnimationObject({animation:a.anim}));return b},hc={},ad=0,Na=function(a,b){this.file=a;this.loaded=!1;this.h=this.w=0;this.id=ad++;this.toLoad=[];var c=m.document.createElement("img"),d=this;hc[a]=d;c.onload=function(){d.loaded=!0;d.w=this.width;d.h=this.height;d.img=m.document.createElement("canvas");d.img.width=this.width;d.img.height=this.height;d.context=d.img.getContext("2d");d.context.drawImage(this,0,0);d.toLoad.length&&A(d.toLoad,function(e){e.func(d.context,
e.w,e.h,e.r)});b&&(d.onLoad=b,d.onLoad());J.load()};c.src=a;J.add()};Na.prototype.onContext=function(a){this.loaded?a(this.context,this.w,this.h,1):this.toLoad.push({w:this.w,h:this.h,r:1,func:a})};Na.prototype.getCanvas=function(){return this.img};var bd=0;Na.prototype.getAnimation=function(a,b,c,d,e){var l=function(n,p,u,B,N,W){this.id=bd++;this.image=n;this.x=p;this.y=u;this.w=B;this.h=N;this.endFrame=this.r=W?W-1:0;this.frameCount=this.r+1};l.prototype={onContext:function(n){this.image.loaded?
n(this.image.context,this.w,this.h,this.r):this.image.toLoad.push({w:this.w,h:this.h,r:this.r,func:n})},getImage:function(){return this.image},getCount:function(){return this.r}};return new l(this,a,b,c,d,e)};var ic=function(a,b){this.loaded=!0;this.w=a;this.h=b;this.img=m.document.createElement("canvas");this.img.width=a;this.img.height=b;this.context=this.img.getContext("2d")};ic.prototype.onContext=Na.prototype.onContext;ic.prototype.getAnimation=Na.prototype.getAnimation;this.tiles.newDrawImage=
function(a,b){return new ic(a,b)};this.tiles.newImage=function(a,b){return hc[a]?hc[a]:new Na(a,b)};this.tiles.newAnimation=function(a,b,c,d){return(new Na(a)).getAnimation(0,0,b,c,d)};var gc=function(a,b,c,d,e){if(a&&a.image.loaded){k.globalAlpha=e;e=-h.x;var l=-h.y;a.image.img&&k.drawImage(a.image.img,a.x+a.w*d,a.y,a.w,a.h,b.x+e,b.y+l,c.w,c.h)}},v={},Ic=function(a,b,c){if(C(v[a])){b.loaded=!0;b.file=a;if(b.w&&!b.h){var d=b.w/v[a].w;var e=b.w;var l=v[a].h*d}else!b.w&&b.h?(d=b.h/v[a].h,l=b.h,e=v[a].w*
d):b.w&&b.h?(e=b.w,l=b.h):(e=v[a].w,l=v[a].h);c&&(e*=c,l*=c);b.w=e;b.h=l;b.forOnLoad&&b.forOnLoad()}else e=m.document.createElement("img"),e.onload=function(){v[a]={};v[a].loaded=!0;v[a].img=this;v[a].w=this.width;v[a].h=this.height;if(C(b)){b.loaded=!0;if(b.w&&!b.h){var n=b.w/v[a].w;var p=b.w;var u=v[a].h*n}else!b.w&&b.h?(n=b.h/v[a].h,u=b.h,p=v[a].w*n):b.w&&b.h?(p=b.w,u=b.h):(p=v[a].w,u=v[a].h);c&&(p*=c,u*=c);b.w=p;b.h=u;b.file=a;b.forOnLoad&&b.forOnLoad()}J.load()},e.src=a,J.add()},Jc=function(a,
b,c,d){if(c){k.globalAlpha=d;d=-h.x;var e=-h.y;v[c]&&k.drawImage(v[c].img,0,0,v[c].w,v[c].h,a.x+d,a.y+e,b.w,b.h)}},Kc=function(a){this.type="Mesh";this.objs=[];this.x=a.x||0;this.y=a.y||0;this.angle=a.angle||0;this.count=0;var b=this;a.add&&A(a.add,function(c){b.add(c)});this.angle&&this.setAngle(this.angle)};Kc.prototype={getCount:function(){return this.count},getObjects:function(){return this.objs},add:function(a){this.count+=1;this.objs.push(a);a.offsetMesh=a.getPosition(1);a.turn(this.angle);
a.setPositionC(g(this.x+a.offsetMesh.x,this.y+a.offsetMesh.y))},delName:function(a){for(var b in this.objs)this.objs[b].id==a.id&&this.objs.splice(b,1)},delID:function(a){for(var b in this.objs)this.objs[b].id==a&&this.objs.splice(b,1)},draw:function(a){A(this.objs,function(b){b.draw()})},move:function(a){this.x+=a.x||0;this.y+=a.y||0;var b=this;A(this.objs,function(c){c.setPositionC(g(b.x+c.offsetMesh.x,b.y+c.offsetMesh.y))})},turn:function(a){if(0!=a){this.angle%=360;this.angle+=a;var b=g(this.x,
this.y),c=this;A(this.objs,function(d){d.turn(a);d.setPositionC(M(g(c.x+d.offsetMesh.x,c.y+d.offsetMesh.y),b,c.angle))})}},setAngle:function(a){if(a!=this.angle){this.angle=a%=360;var b=g(this.x,this.y),c=this;A(this.objs,function(d){d.setAngle(a);d.setPositionC(M(g(c.x+d.offsetMesh.x,c.y+d.offsetMesh.y),b,c.angle))})}},setPosition:function(a){if(a){this.x=a.x||this.x;this.y=a.y||this.y;var b=this;A(this.objs,function(c){b.angle?c.setPositionC(M(g(b.x+c.offsetMesh.x,b.y+c.offsetMesh.y),g(b.x,b.y),
b.angle)):c.setPositionC(g(b.x+c.offsetMesh.x,b.y+c.offsetMesh.y))})}},setPositionS:function(a){if(a){pjs.OOP.once("setPosSmesh",function(){h.x=q/2;h.y=r/2});this.x=a.x+h.x;this.y=a.y+h.y;var b=this;A(this.objs,function(c){b.angle?c.setPositionC(M(g(b.x+c.offsetMesh.x,b.y+c.offsetMesh.y),g(b.x,b.y),b.angle)):c.setPositionC(g(b.x+c.offsetMesh.x,b.y+c.offsetMesh.y))})}},isDynamicIntersect:function(a){if(3>a.length)return!1;var b=!1;A(this.objs,function(c){if(c.isDynamicIntersect(a))return b=c});return b},
isStaticIntersect:function(a){var b=!1;A(this.objs,function(c){if(c.isStaticIntersect(a))return b=c});return b},isIntersect:function(a){var b=!1;A(this.objs,function(c){if(c.isIntersect(a))return b=c});return b}};this.game.newMesh=function(a){return new Kc(a)};this.camera.shake=function(a,b){h.x=a.x+fa(-1,1,!0)*b.w;h.y=a.y+fa(-1,1,!0)*b.h};this.camera.shakeC=function(a,b){h.x=-S+a.x+fa(-1,1,!0)*b.w;h.y=-T+a.y+fa(-1,1,!0)*b.h};this.camera.scale=function(a){Fa*=a.x;Ga*=a.y;q/=a.x;r/=a.y;S=q/2;T=r/2;
k.scale(a.x,a.y);k.save();db&&(D.x/=a.x,D.y/=a.y)};this.camera.scaleC=function(a){var b=q,c=r;Fa*=a.x;Ga*=a.y;q/=a.x;r/=a.y;S=q/2;T=r/2;k.scale(a.x,a.y);k.save();h.x+=(b-q)/2;h.y+=(c-r)/2;db&&(D.x/=a.x,D.y/=a.y)};this.camera.circling=function(a,b,c){C(this.circlingAnglePointJS)||(this.circlingAnglePointJS=c);h.x=a.x+b*Math.cos(K(this.circlingAnglePointJS));h.y=a.y+b*Math.sin(K(this.circlingAnglePointJS));this.circlingAnglePointJS=360<=this.circlingAnglePointJS?c:this.circlingAnglePointJS+c};this.camera.circlingC=
function(a,b,c){C(this.circlingAnglePointJS)||(this.circlingAnglePointJS=c);h.x=-S+a.x+b*Math.cos(K(this.circlingAnglePointJS));h.y=-T+a.y+b*Math.sin(K(this.circlingAnglePointJS));this.circlingAnglePointJS=360<=this.circlingAnglePointJS?c:this.circlingAnglePointJS+c};this.camera.motion=function(a,b,c){C(this.motionPercentPointJS)||(this.motionPercentPointJS=b);h.x=a.x+b.w*Math.cos(K(this.motionPercentPointJS));h.y=a.y+b.h*Math.sin(K(this.motionPercentPointJS));this.motionPercentPointJS=360<=this.motionPercentPointJS?
b:this.motionPercentPointJS+c};this.camera.motionC=function(a,b,c){C(this.motionPercentPointJS)||(this.motionPercentPointJS=b);this.setPositionC(g(a.x+b.w*Math.cos(K(this.motionPercentPointJS)),a.y+b.h*Math.sin(K(this.motionPercentPointJS))));this.motionPercentPointJS=360<=this.motionPercentPointJS?b:this.motionPercentPointJS+c};this.camera.follow=function(a,b){this.moveTimeC(a.getPositionC(),b||10)};this.camera.move=function(a){h.x+=Math.trunc(a.x)||0;h.y+=Math.trunc(a.y)||0};this.camera.moveTime=
function(a,b){b=b||1;var c=g(h.x,h.y);this.move(g(Fa*(a.x-c.x)/b,Ga*(a.y-c.y)/b))};this.camera.moveTimeC=function(a,b){b=b||1;var c=g(h.x+S,h.y+T);this.move(g(Fa*(a.x-c.x)/b,Ga*(a.y-c.y)/b))};this.camera.setPosition=function(a){bc(g(!1!==a.x?a.x:h.x,!1!==a.y?a.y:h.y))};this.camera.setPositionC=function(a){bc(g(!1!==a.x?a.x-S:h.x,!1!==a.y?a.y-T:h.y))};this.camera.getPosition=function(a){return a?g(h.x+S,h.y+T):g(h.x,h.y)};this.camera.getPositionC=function(){return g(h.x+S,h.y+T)};this.camera.getStaticBox=
function(){return{x:h.x,y:h.y,w:q,h:r}};this.camera.getDynamicBox=function(){return[g(h.x,h.y),g(h.x+q,h.y),g(h.x+q,h.y+r),g(h.x,h.y+r)]};this.camera.drawCamera=function(a,b){var c=$jscomp.makeIterator(a);c.next();c.next();c.next();c.next();ia(g(h.x,h.y),G(h.x+q,h.y+r),!1,b||"red",2);Jb(g(h.x+q/2,h.y+r/2),10,b||"red");if(0<a.length){c=a[2]||100;var d=a[3]||100;ia(g(h.x+(a[0]||0),h.y+(a[1]||0)),G(h.x+c,h.y+d),!1,b||"red",2);Jb(g(h.x+c/2,h.y+d/2),10,b||"red")}};var bc=function(a){h=g(a.x,a.y)},Y=function(a){k.restore();
k.globalAlpha=z.globalAlpha;k.fillStyle="black";k.strokeStyle="black";k.msImageSmoothingEnabled=Wa;k.imageSmoothingEnabled=Wa},Z=function(a,b){k.save();var c=a.getPositionC();a.angle&&(k.translate(-h.x+c.x,-h.y+c.y),k.rotate(K(a.angle)),k.translate(-c.x+h.x,-c.y+h.y));1!==a.alpha&&(k.globalAlpha=a.alpha);if(a.flip.x||a.flip.y)k.translate(-h.x+c.x,-h.y+c.y),k.scale(a.flip.x?-1:1,a.flip.y?-1:1),k.translate(-c.x+h.x,-c.y+h.y);a.shadowColor&&(k.shadowBlur=a.shadowBlur,k.shadowColor=a.shadowColor,k.shadowOffsetX=
a.shadowX,k.shadowOffsetY=a.shadowY);if("EllipseObject"===a.type&&!b){c=a.w/2;var d=a.h/2,e=g(-h.x+a.x,-h.y+a.y);k.translate(e.x,e.y);k.scale(c/d,1);k.translate(-e.x,-e.y)}};this.system.setContextSettings=function(a){k.save();for(var b in a)k[b]=a[b]};this.system.defaultSettings=function(){Y()};this.game.clear=function(){k.clearRect(0,0,q,r)};this.game.fill=function(a){k.fillStyle=a;k.fillRect(0,0,q,r)};var La=function(a,b,c,d,e,l,n,p){if(!(3>c.length)){k.globalAlpha=p;if(d&&!(3>c.length)){k.fillStyle=
d;d=-h.x+a;p=-h.y+b;var u;k.beginPath();k.moveTo(d+c[0].x,p+c[0].y);for(u=1;u<c.length;u+=1)k.lineTo(d+c[u].x,p+c[u].y);k.closePath();k.fill()}for(d=0;d<c.length;d+=1)p=d+1<c.length?d+1:0,e&&ra(ob(c[d],g(a,b)),ob(c[p],g(a,b)),e,l),n&&Nb(ob(c[d],g(a,b)),n)}},ja=function(a){a.x||(a.x=0);a.y||(a.y=0);a.w||(a.w=0);a.h||(a.h=0)};this.brush.drawPolygon=function(a){var b=a.points||[],c=a.fillColor||!1,d=a.strokeColor||!1,e=a.strokeWidth||1,l=a.pointColor||!1;a=k.globalAlpha=a.alpha||1;if(!(3>b.length)){k.globalAlpha=
a;if(c&&!(3>b.length)){k.fillStyle=c;c=-h.x;a=-h.y;var n;k.beginPath();k.moveTo(c+b[0].x,a+b[0].y);for(n=1;n<b.length;n+=1)k.lineTo(c+b[n].x,a+b[n].y);k.closePath();k.fill()}for(c=0;c<b.length;c+=1)a=c+1<b.length?c+1:0,d&&ra(b[c],b[a],d,e),l&&Nb(b[c],l)}};this.brush.drawTriangle=function(a){ja(a);if(a.x+a.w<h.x||a.x>h.x+q||a.y+a.h<h.y||a.y>h.y+r)return!1;La(a.x,a.y,[g(a.w/2,0),g(a.w,a.h),g(0,a.h)],a.fillColor,a.strokeColor,a.strokeWidth,k.globalAlpha=a.alpha||1)};this.brush.drawTriangleS=function(a){ja(a);
if(0>a.x+a.w||a.x>q||0>a.y+a.h||a.y>r)return!1;La(h.x+a.x,h.y+a.y,[g(a.w/2,0),g(a.w,a.h),g(0,a.h)],a.fillColor,a.strokeColor,a.strokeWidth,k.globalAlpha=a.alpha||1)};var Ma=function(a,b,c,d,e,l,n,p,u){0>=u&&(p=!1);k.textAlign=n;k.lineWidth=u;k.font=(l?l+" ":"")+d+"px "+e;d=-h.x;e=-h.y;c&&(k.fillStyle=c,k.fillText(b,d+a.x,e+a.y));p&&(k.strokeStyle=p,k.strokeText(b,d+a.x,e+a.y))};this.brush.drawMultiText=function(a){var b,c=a.text.split("\n");for(b=0;b<c.length;b+=1)Ma(g(a.x,a.y+a.size*b),c[b],a.color||
z.fillStyle,a.size||10,a.font||z.font,a.style||!1,a.align||"left",a.strokeColor||!1,a.strokeWidth||2,k.globalAlpha=a.alpha||1)};this.brush.drawMultiTextS=function(a){var b,c=a.text.split("\n"),d=a.size||10;for(b=0;b<c.length;b+=1)Ma(g(a.x+h.x,a.y+h.y+d*b),c[b],a.color||z.fillStyle,d||10,a.font||z.font,a.style||!1,a.align||"left",a.strokeColor||!1,a.strokeWidth||2,k.globalAlpha=a.alpha||1)};this.brush.drawText=function(a){Ma(g(a.x||0,a.y||0),a.text,a.color||!1,a.size||10,a.font||z.font,a.style||!1,
a.align||"left",a.strokeColor||!1,a.strokeWidth||2,k.globalAlpha=a.alpha||1)};this.brush.drawTextS=function(a){Ma(g((a.x||0)+h.x,(a.y||0)+h.y),a.text,a.color||z.fillStyle,a.size||10,a.font||z.font,a.style||!1,a.align||"left",a.strokeColor||!1,a.strokeWidth||2,k.globalAlpha=a.alpha||1)};this.brush.drawTextLines=function(a){if(a.lines){var b,c=a.size||10;for(b=0;b<a.lines.length;b+=1)Ma(g(a.x||0,(a.y||0)+c*b*a.lineHeight),a.lines[b],a.color||z.fillStyle,c,a.font||z.font,a.style||!1,a.align||"left",
a.strokeColor||!1,a.strokeWidth||2,k.globalAlpha=a.alpha||1)}};this.brush.drawTextLinesS=function(a){if(a.lines){var b,c=a.size||10;for(b=0;b<a.lines.length;b+=1)Ma(g((a.x||0)+h.x,(a.y||0)+h.y+c*b*a.lineHeight),a.lines[b],a.color||z.fillStyle,c,a.font||z.font,a.style||!1,a.align||"left",a.strokeColor||!1,a.strokeWidth||2,k.globalAlpha=a.alpha||1)}};var Jb=function(a,b,c){ra(g(a.x-b,a.y),g(a.x+b,a.y),c,2);ra(g(a.x,a.y-b),g(a.x,a.y+b),c,2)},ia=function(a,b,c,d,e,l){k.fillStyle=c;k.strokeStyle=d;k.globalAlpha=
l;d=-h.x;l=-h.y;c&&k.fillRect(a.x+d,a.y+l,b.w,b.h);e&&(k.lineWidth=e,c=e/2,k.strokeRect(a.x+d+c,a.y+l+c,b.w-e,b.h-e))};this.brush.drawRect=function(a){ja(a);if(a.x+a.w<h.x||a.x>h.x+q||a.y+a.h<h.y||a.y>h.y+r)return!1;ia(g(a.x,a.y),G(a.w,a.h),a.fillColor||!1,a.strokeColor||z.strokeStyle,a.strokeWidth||!1,k.globalAlpha=a.alpha||1)};this.brush.drawRectS=function(a){ja(a);if(0>a.x+a.w||a.x>q||0>a.y+a.h||a.y>r)return!1;ia(g(a.x+h.x,a.y+h.y),G(a.w,a.h),a.fillColor||!1,a.strokeColor||z.strokeStyle,a.strokeWidth||
!1,k.globalAlpha=a.alpha||1)};var Nb=function(a,b){(k.fillStyle=b)&&k.fillRect(-h.x+a.x-1,-h.y+a.y-1,2,2)};this.brush.drawPoint=function(a){ja(a);if(a.x<h.x||a.x>h.x+q||a.y<h.y||a.y>h.y+r)return!1;Nb(g(a.x,a.y),a.fillColor||!1,k.globalAlpha=a.alpha||1)};this.brush.drawPointS=function(a){ja(a);if(0>a.x||a.x>q||0>a.y||a.y>r)return!1;Nb(g(a.x+h.x,a.y+h.y),a.fillColor||!1,k.globalAlpha=a.alpha||1)};var Mb=function(a,b,c,d,e,l,n){k.fillStyle=d;k.strokeStyle=e;k.globalAlpha=n;k.lineWidth=l;e=-h.x+a.x+l/
2;a=-h.y+a.y+l/2;b.w-=+l;b.h-=+l;k.beginPath();k.moveTo(e+c,a);k.lineTo(e+b.w-c,a);k.quadraticCurveTo(e+b.w,a,e+b.w,a+c);k.lineTo(e+b.w,a+b.h-c);k.quadraticCurveTo(e+b.w,a+b.h,e+b.w-c,a+b.h);k.lineTo(e+c,a+b.h);k.quadraticCurveTo(e,a+b.h,e,a+b.h-c);k.lineTo(e,a+c);k.quadraticCurveTo(e,a,e+c,a);k.closePath();d&&k.fill();l&&k.stroke()};this.brush.drawRoundRect=function(a){ja(a);if(a.x+a.w<h.x||a.x>h.x+q||a.y+a.h<h.y||a.y>h.y+r)return!1;Mb(g(a.x,a.y),G(a.w,a.h),a.radius||2,a.fillColor||!1,a.strokeColor||
z.strokeStyle,a.strokeWidth||!1,k.globalAlpha=a.alpha||1)};this.brush.drawRoundRectS=function(a){ja(a);if(0>a.x+a.w||a.x>q||0>a.y+a.h||a.y>r)return!1;Mb(g(h.x+a.x,h.y+a.y),G(a.w,a.h),a.radius||2,a.fillColor||!1,a.strokeColor||z.strokeStyle,a.strokeWidth||!1,k.globalAlpha=a.alpha||1)};var Ta=function(a,b,c,d,e,l){k.fillStyle=c;k.strokeStyle=d;k.globalAlpha=l;k.lineWidth=e;d=-h.x+b+(e?e/2:0);l=-h.y+b+(e?e/2:0);k.beginPath();k.arc(a.x+d,a.y+l,b,0,2*Math.PI,!0);k.closePath();c&&k.fill();e&&k.stroke()};
this.brush.drawCircle=function(a){ja(a);var b=2*a.radius;if(a.x+b<h.x||a.x>h.x+q||a.y+b<h.y||a.y>h.y+r)return!1;Ta(g(a.x,a.y),a.radius,a.fillColor||!1,a.strokeColor||z.strokeStyle,a.strokeWidth||!1,k.globalAlpha=a.alpha||1)};this.brush.drawCircleS=function(a){ja(a);var b=2*a.radius;if(0>a.x+b||a.x>q||0>a.y+b||a.y>r)return!1;Ta(g(a.x+h.x,a.y+h.y),a.radius,a.fillColor||!1,a.strokeColor||z.strokeStyle,a.strokeWidth||!1,k.globalAlpha=a.alpha||1)};var ra=function(a,b,c,d){k.strokeStyle=c;k.lineWidth=d;
c=-h.x;d=-h.y;k.beginPath();k.moveTo(c+a.x,d+a.y);k.lineTo(c+b.x,d+b.y);k.closePath();k.stroke()};this.brush.drawLineAngle=function(a){var b=M(g(a.x+a.length,a.y),g(a.x,a.y),a.angle);ra(g(a.x,a.y),g(b.x,b.y),a.strokeColor||z.strokeStyle,a.strokeWidth||1,k.globalAlpha=a.alpha||1)};this.brush.drawLineAngleS=function(a){var b=M(g(h.x+a.x+a.length,h.y+a.y),g(h.x+a.x,h.y+a.y),a.angle);ra(g(h.x+a.x,h.y+a.y),g(b.x,b.y),a.strokeColor||z.strokeStyle,a.strokeWidth||1,k.globalAlpha=a.alpha||1)};this.brush.drawLine=
function(a){ra(g(a.x1,a.y1),g(a.x1+a.x2,a.y1+a.y2),a.strokeColor||z.strokeStyle,a.strokeWidth||1,k.globalAlpha=a.alpha||1)};this.brush.drawLineS=function(a){ra(g(h.x+a.x1,h.y+a.y1),g(h.x+a.x2,h.y+a.y2),a.strokeColor||z.strokeStyle,a.strokeWidth||1,k.globalAlpha=a.alpha||1)};this.brush.drawLineA=function(a){ra(g(a.x1,a.y1),g(a.x2,a.y2),a.strokeColor||z.strokeStyle,a.strokeWidth||1,k.globalAlpha=a.alpha||1)};this.brush.drawLineAS=function(a){ra(g(a.x1+h.x,a.y1+h.y),g(a.x2+h.x,a.y2+h.y),a.strokeColor||
z.strokeStyle,a.strokeWidth||1,k.globalAlpha=a.alpha||1)};this.brush.drawEllipse=function(a){ja(a);if(a.x+a.w<h.x||a.x>h.x+q||a.y+a.h<h.y||a.y>h.y+r)return!1;var b=a.w/2,c=a.h/2,d=g(-h.x+a.x,-h.y+a.y);k.save();k.translate(d.x,d.y);k.scale(b/c,1);k.translate(-d.x,-d.y);Ta(g(a.x,a.y),c,a.fillColor,a.strokeColor,a.strokeWidth,k.globalAlpha=a.alpha||1);k.restore()};this.brush.drawEllipseS=function(a){ja(a);if(0>a.x+a.w||a.x>q||0>a.y+a.h||a.y>r)return!1;var b=a.w/2,c=a.h/2,d=g(a.x,a.y);k.save();k.translate(d.x,
d.y);k.scale(b/c,1);k.translate(-d.x,-d.y);Ta(g(h.x+a.x,h.y+a.y),c,a.fillColor,a.strokeColor,a.strokeWidth,k.globalAlpha=a.alpha||1);k.restore()};this.brush.drawImageS=function(a){if(a.file)if(C(v[a.file])){if(v[a.file].loaded){var b=a.x||0,c=a.y||0;if(a.w&&!a.h){var d=a.w/v[a.file].w;var e=a.w;var l=v[a.file].h*d}else!a.w&&a.h?(d=a.h/v[a.file].h,l=a.h,e=v[a.file].w*d):a.w&&a.h?(e=a.w,l=a.h):(e=v[a.file].w,l=v[a.file].h);a.scale&&(e*=a.scale,l*=a.scale);if(0>b+e||b>q||0>c+l||c>r)return!1;k.drawImage(v[a.file].img,
0,0,v[a.file].w,v[a.file].h,b,c,e,l,k.globalAlpha=a.alpha||1)}}else v[a.file]={loaded:!1},b=m.document.createElement("img"),b.onload=function(){v[a.file].loaded=!0;v[a.file].img=this;v[a.file].w=this.width;v[a.file].h=this.height;J.load()},b.src=a.file,J.add()};this.brush.drawImage=function(a){if(a.file)if(C(v[a.file])){if(v[a.file].loaded){var b=a.x||0,c=a.y||0;if(a.w&&!a.h){var d=a.w/v[a.file].w;var e=a.w;var l=v[a.file].h*d}else!a.w&&a.h?(d=a.h/v[a.file].h,l=a.h,e=v[a.file].w*d):a.w&&a.h?(e=a.w,
l=a.h):(e=v[a.file].w,l=v[a.file].h);a.scale&&(e*=a.scale,l*=a.scale);if(b+e<h.x||b>h.x+q||c+l<h.y||c>h.y+r)return!1;k.drawImage(v[a.file].img,0,0,v[a.file].w,v[a.file].h,-h.x+b,-h.y+c,e,l,k.globalAlpha=a.alpha||1)}}else v[a.file]={},v[a.file].loaded=!1,b=m.document.createElement("img"),b.onload=function(){v[a.file].loaded=!0;v[a.file].img=this;v[a.file].w=this.width;v[a.file].h=this.height;J.load()},b.src=a.file,J.add()};this.brush.onContext=function(a){a(k)};this.brush.getPixelColor=function(a,
b){var c=k.getImageData(a,b,1,1).data;return"rgb("+c[0]+", "+c[1]+", "+c[2]+")"};this.brush.setPixelColor=function(a,b,c){var d=k.createImageData(1,1);d.data[0]=c.r||d.data[0];d.data[1]=c.g||d.data[1];d.data[2]=c.b||d.data[2];d.data[3]=c.a||255;k.putImageData(d,a,b)};this.brush.onPixel=function(a,b,c){var d=k.getImageData(a,b,1,1),e={r:d.data[0],g:d.data[1],b:d.data[2],a:d.data[3]?d.data[3]:255};c(e);d.data[0]=e.r;d.data[1]=e.g;d.data[2]=e.b;d.data[3]=e.a;k.putImageData(d,a,b)};this.brush.onPixels=
function(a,b,c,d,e){c=k.getImageData(a,b,c,d);var l;d=0;for(l=c.data.length;d<l;d+=4){var n={r:c.data[d],g:c.data[d+1],b:c.data[d+2],a:c.data[d+3]?c.data[d+3]:255};e(n);c.data[d]=n.r;c.data[d+1]=n.g;c.data[d+2]=n.b;c.data[d+3]=n.a}k.putImageData(c,a,b)};this.brush.onRawPixels=function(a,b,c,d,e){c=k.getImageData(a,b,c,d);e(c.data,c.data.length);k.putImageData(c,a,b)};var ka=m.AudioContext||m.webkitAudioContext||!1;(ka=ka?new ka:!1)&&ka.listener.setPosition(0,0,0);var la=function(a,b){ka||ua('module "wAudio" is not supported! use a "audio"');
this.vol=1>=b&&0<=b?b:1;this.loadPLay=this.nextPlay=this.loaded=this.playing=!1;this.pausedTime=this.duration=this.startTime=0;var c=this,d=new XMLHttpRequest;d.open("GET",a,!0);d.responseType="arraybuffer";d.onload=function(e){ka.decodeAudioData(this.response,function(l){c.wABuffer=l;c.duration=c.wABuffer.duration;c.wAGain=ka.createGain();c.wAGain.gain.value=c.vol;c.wAPanner=ka.createPanner();c.wAPanner.setPosition(0,0,1);c.wAPanner.panningModel="equalpower";J.load();c.loaded=!0;c.loadPlay&&c.replay()},
function(l){ua("error in wAudio.newAudio : error decoding file",l)})};a?d.send():ua("error in wAudio.newAudio : Where is file?");J.add()};la.prototype.play=function(a){if(!this.loaded)this.loadPlay=!0;else if(!this.playing){this.playing=!0;this.wASource=ka.createBufferSource();this.wASource.buffer=this.wABuffer;this.wAListener=ka.destination;this.wASource.connect(this.wAGain);this.wAGain.connect(this.wAPanner);this.wAPanner.connect(this.wAListener);this.wASource.start(0,this.pausedTime,this.duration);
this.startTime=ka.currentTime;var b=this;this.wASource.onended=function(){b.playing=!1;b.startTime=0;b.pausedTime=0;b.nextPlay&&b.nextPlay.replay()}}};la.prototype.replay=function(a){this.loaded?(this.stop(),this.play()):this.loadPlay=!0};la.prototype.stop=function(){this.pause();this.pausedTime=this.startTime=0};la.prototype.pause=function(){if(this.playing){this.pausedTime=this.getProgress();this.playing=!1;this.wASource.stop(0);var a=this;this.wASource.onended=function(){a.playing=!1}}};la.prototype.getProgress=
function(){return this.playing?ka.currentTime-this.startTime+this.pausedTime:this.pausedTime};la.prototype.playPause=function(){this.playing?this.pause():this.play()};la.prototype.setNextPlay=function(a){this.nextPlay=a};la.prototype.setVolume=function(a){this.vol=1>=a&&0<=a?a:this.vol;this.wAGain.gain.value=this.vol};la.prototype.getVolume=function(){return this.vol};la.prototype.setSide=function(a){this.side=a;this.wAPanner&&this.wAPanner.setPosition(this.side,0,1-Math.abs(this.side))};la.prototype.getSide=
function(){return this.side};this.wAudio.newAudio=function(a,b){return new la(a,b)};var sa=function(a,b){var c,d=m.document.createElement("audio");if("string"==typeof a){var e=m.document.createElement("source");e.src=a;d.appendChild(e)}else{var l=0;for(c=a.length;l<c;l+=1)e=m.document.createElement("source"),e.src=a[l],d.appendChild(e)}this.vol=1>=b&&0<=b?b:1;this.playing=0;this.audio=d;this.nextPlay=this.loaded=!1;this.startVol=0;this.memoryVol=1>=b&&0<=b?b:1;this.flagInOut=!1;d.volume=this.vol;
var n=this;d.onloadeddata=function(){n.loaded=!0;J.load()};d.onended=function(){n.playing=!1;n.nextPlay&&n.nextPlay.play()};d.load();J.add()};sa.prototype.play=function(a){this.playing||(a&&(this.vol=1>=a&&0<=a?a:this.vol,this.audio.volume=this.vol),this.startVol=0,this.playing=!0,this.audio.play())};sa.prototype.replay=function(a){a&&this.setVolume(a);this.startVol=0;this.flagInOut=this.playing=!0;this.audio.currentTime=0;this.audio.play()};sa.prototype.stop=function(){this.playing&&(this.startVol=
0,this.playing=!1,this.audio.pause(),this.audio.currentTime=0)};sa.prototype.pause=function(){this.playing&&(this.playing=!1,this.audio.pause())};sa.prototype.playPause=function(){this.playing?(0==this.startVol&&this.pause(),this.flagInOut=!1):(this.play(),this.flagInOut=!0)};sa.prototype.setNextPlay=function(a){this.nextPlay=a};sa.prototype.setVolume=function(a){this.vol=1>=a&&0<=a?a:this.vol;this.memoryVol=this.audio.volume=this.vol};sa.prototype.getVolume=function(){return this.vol};sa.prototype.easyEase=
function(a,b){if(this.startVol<=this.memoryVol&&1==this.playing&&1==this.flagInOut){this.startVol+=a;if(1<=this.startVol||this.startVol>=this.memoryVol)return;this.audio.volume=this.startVol}0<this.startVol&&1==this.playing&&0==this.flagInOut&&(this.startVol-=b||a,0>=this.startVol?(this.playing=!1,this.audio.volume=0,this.pause()):this.audio.volume=this.startVol)};this.audio.newAudio=function(a,b){return new sa(a,b)};var Ob=[],Oa=[];this.zList.useZValue=function(){this.update=function(){Oa.length=
0;A(Ob,function(a){a.isInCamera()&&Oa.push(a)});Oa.sort(function(a,b){return a.z-b.z})}};this.zList.useYValue=function(){this.update=function(){Oa.length=0;A(Ob,function(a){a.isInCamera()&&Oa.push(a)});Oa.sort(function(a,b){return a.y+a.h-(b.y+b.h)})}};this.zList.add=function(a){Ob.push(a)};this.zList.init=function(a){A(a,function(b){F.zList.add(b)})};this.zList.draw=function(a){F.OOP.drawArr(Oa,a)};this.zList.del=function(a){F.OOP.delObject(Ob,a)};this.zList.useYValue();var J={count:0,loaded:0,errored:0,
add:function(){this.count+=1},load:function(){this.loaded+=1},error:function(){this.errored+=1}};this.resources.isLoaded=function(){return J.count==J.loaded};this.resources.getProgress=function(){return Math.ceil(J.loaded/J.count*100)};this.levels.forStringArray=function(a,b){var c=a.offset||g(0,0);A(a.source,function(d,e){A(d,function(l,n){" "!==l&&b(l,c.x+a.w*n,c.y+a.h*e,a.w,a.h)})})};var cd=function(a){if("AnimationObject"===a.type&&"undefined"!==typeof __LVL_ANIMATIONS&&a.__realAnim){var b=__LVL_ANIMATIONS[a.__realAnim];
a.startFrame&&(a.frame=a.startFrame);a.anim="undefined"!==typeof a.anim&&a.anim&&a.anim.x&&a.anim.y?F.tiles.newImage(b.file).getAnimation(a.anim.x,a.anim.y,b.w,b.h,b.frames):F.tiles.newImage(b.file).getAnimation(b.x,b.y,b.w,b.h,b.frames)}var c=Bc(a);c.name="";Q(a,function(d,e){"id"!==e&&"anim"!==e&&(c[e]=d)});return c},Lc=function(a,b){var c={settings:{},objects:[]};a=JSON.parse(a);c.settings=a.settings;A(a.objects,function(d){var e=cd(d);e.name=d.name;b&&b(e);c.objects.push(e)});return c},Mc=function(a,
b,c){var d=[],e={};if(a&&"json"===b){b=Lc(a,c);d=b.objects;e=b.settings;var l=a}this.backgroundColor=e.backgroundColor?e.backgroundColor:!1;this.reload=function(){d=Lc(l)};this.clear=function(){Ac(d)};this.add=function(n){d.push(n)};this.del=function(n){A(d,function(p,u){if(n===p)return d.splice(u,1),"break"})};this.delById=function(n){d.splice(n,1)};this.getObjects=function(){return d};this.getObjectByName=function(n){var p;var u=0;for(p=d.length;u<p;u+=1)if(d[u].name==n)return d[u];return!1};this.getObjectById=
function(n){var p;var u=0;for(p=d.length;u<p;u+=1)if(d[u].id==n)return d[u];return!1};this.draw=function(n){this.backgroundColor&&F.game.fill(this.backgroundColor);A(d,function(p){n&&n(p);p.isInCamera()&&p.draw()})};this.getObjectsInCamera=function(){var n=[];A(d,function(p){p.isInCamera()&&n.push(p)});return n};this.getLevelAsJSON=function(n,p){var u='{"settings":'+JSON.stringify({backgroundColor:this.backgroundColor})+',"objects":[';if(!d.length)return u+"]}";A(d,function(B,N){n&&n(B);u+="{";Q(B,
function(W,X){"function"!=typeof W&&(u+='"'+X+'":'+JSON.stringify(W)+",")});u=u.substr(0,u.length-1)+"},";p&&p(B)});u=u.substr(0,u.length-1);return u+"]}"}};this.levels.newLevelFromJSON=function(a,b){return new Mc(a,"json",b||!1)};this.levels.newEmptyLevel=function(a){return new Mc(!1)};var Nc=0,Oc=0,jc=0,Pc=!1;this.system.initFPSCheck=function(){Pc||(Pc=!0,t.addEvent("postLoop","fpsCheckUpdate",function(){jc+=1;1E3<=da-Oc&&(Nc=jc,jc=0,Oc=da)}))};this.system.getFPS=function(){return Nc};var Pb=this.filters;
Pb.setCSSFilter=function(a,b){var c=(b?b.canvas:w).style,d="";Q(a,function(e,l){d+=" "+l+"("+e+")"});c.OFilter=c.MozFilter=c.WebkitFilter=c.filter=d};Pb.clearCSSFilter=function(a){a=(a?a.canvas:w).style;a.OFilter=a.MozFilter=a.WebkitFilter=a.filter="none"};Pb.setCSSTransform=function(a,b){var c=(b?b.canvas:w).style,d="perspective("+q+"px)";Q(a,function(e,l){d+=" "+l+"("+e+")"});c.transform=c.MozTransform=c.WebkitTransform=d};Pb.clearCSSTransform=function(a){a=(a?a.canvas:w).style;a.transform=a.MozTransform=
a.WebkitTransform="none"};var f=this.presets;f.key={NAME:null,keyMoveDX:0,keyMoveDY:0,p:0,test:!1,CollisionRight:!1,CollisionLeft:!1,CollisionUp:!1,CollisionDown:!1,CollisionSome:!1};f.keyMoveInit=function(a,b,c,d,e,l,n){f.key.NAME=a;f.key.SPEED=b;f.key.keyMoveDX=0;f.key.keyMoveDY=0;f.key.p=pjs.vector.point;f.key.test=n;a=pjs.keyControl.isDown;f.key.keyMoveDX=f.key.keyMoveDY=0;if(a(c[0])||a(c[1])||a(c[2])||a(c[3]))f.key.keyMoveDX=f.key.SPEED||1;if(a(d[0])||a(d[1])||a(d[2])||a(d[3]))f.key.keyMoveDX=
-f.key.SPEED||-1;if(a(e[0])||a(e[1])||a(e[2])||a(e[3]))f.key.keyMoveDY=-f.key.SPEED||-1;if(a(l[0])||a(l[1])||a(l[2])||a(l[3]))f.key.keyMoveDY=f.key.SPEED||1};f.keyMoveCollision=function(a){a.isStaticIntersect(f.key.NAME.getStaticBoxD(0,0,f.key.SPEED,0))&&0==f.key.CollisionLeft?f.key.keyMoveDX==f.key.SPEED&&(f.key.keyMoveDX=0,f.key.CollisionRight=!0,1==f.key.test&&a.drawStaticBox(),f.key.NAME.x=a.x-f.key.NAME.w+a.box.x-f.key.NAME.box.x-f.key.NAME.box.w):f.key.CollisionRight=!1;a.isStaticIntersect(f.key.NAME.getStaticBoxA(-f.key.SPEED,
0,f.key.SPEED,0))&&0==f.key.CollisionRight?f.key.keyMoveDX==-f.key.SPEED&&(f.key.keyMoveDX=0,f.key.CollisionLeft=!0,1==f.key.test&&a.drawStaticBox(),f.key.NAME.x=a.x+a.box.x+a.w-f.key.NAME.box.x+a.box.w):f.key.CollisionLeft=!1;a.isStaticIntersect(f.key.NAME.getStaticBoxW(0,-f.key.SPEED,0,f.key.SPEED))&&0==f.key.CollisionDown?f.key.keyMoveDY==-f.key.SPEED&&(f.key.keyMoveDY=0,f.key.CollisionUp=!0,1==f.key.test&&a.drawStaticBox(),f.key.NAME.y=a.y+a.h+a.box.h+a.box.y-f.key.NAME.box.y):f.key.CollisionUp=
!1;a.isStaticIntersect(f.key.NAME.getStaticBoxS(0,0,0,f.key.SPEED))&&0==f.key.CollisionUp?f.key.keyMoveDY==f.key.SPEED&&(f.key.keyMoveDY=0,f.key.CollisionDown=!0,1==f.key.test&&a.drawStaticBox(),f.key.NAME.y=a.y-f.key.NAME.h+a.box.y-f.key.NAME.box.h-f.key.NAME.box.y):f.key.CollisionDown=!1;f.key.CollisionSome=1==f.key.CollisionRight||1==f.key.CollisionLeft||1==f.key.CollisionUp||1==f.key.CollisionDown?!0:!1};f.keyMove=function(){f.key.NAME.move(f.key.p(f.key.keyMoveDX,f.key.keyMoveDY))};f.physics=
{test:!1,frictionX:0,frictionR:0,decayJump:0,NAME:null,keyMoveDX:0,keyMoveDY:0,SPEED:0,GRAVITY:0,DENSITY:0,BOUNCE:0,STICKING:0,minBounce:0,m:0,flag1:!0,GG:0,p:0,memoryDY:0,ROTATION:0,rtStop:0,ACCELETARIONDOWN:0,CollisionRight:!1,CollisionLeft:!1,CollisionUp:!1,CollisionDown:!1,CollisionSome:!1};f.physicsPlayerInit=function(a,b,c,d,e,l,n,p,u,B,N,W,X,I,Ua,kc,Qb,dd){f.physics.FIRCTIONX=B;f.physics.FIRCTIONR=N;f.physics.DECAYJUMP=W;f.physics.test=dd;f.physics.NAME=a;f.physics.SPEED=b;f.physics.DENSITY=
Math.pow(1E3,1/(c/3));1>f.physics.DENSITY&&(f.physics.DENSITY=1);f.physics.rtStop=p;f.physics.BOUNCE=e;0!=f.physics.BOUNCE&&2.4>=f.physics.BOUNCE&&(f.physics.BOUNCE=2.4);pjs.OOP.once("stBox",function(){f.physics.NAME.newStaticBox&&f.physics.NAME.setStaticBox(f.physics.NAME.newStaticBox[0],f.physics.NAME.newStaticBox[1],f.physics.NAME.newStaticBox[2],f.physics.NAME.newStaticBox[3])});f.physics.STICKING=l;f.physics.minBounce=3.2;f.physics.ACCELETARIONDOWN=-u;a=pjs.keyControl.isDown;c=pjs.mouseControl.isPress;
f.physics.p=pjs.vector.point;if(a(X[0])||a(X[1])||a(X[2])||a(X[3])||a(X[4])||a(X[5])||1==Qb[1])f.physics.keyMoveDX=b,1==f.physics.NAME.mirror&&f.physics.NAME.setFlip(0,0),0!=n&&(f.physics.ROTATION=n);else if(a(I[0])||a(I[1])||a(I[2])||a(I[3])||a(I[4])||a(I[5])||1==Qb[0])f.physics.keyMoveDX=-b,1==f.physics.NAME.mirror&&f.physics.NAME.setFlip(1,0),0!=n&&(f.physics.ROTATION=-n);0==f.physics.flag1&&(a(Ua[0])||a(Ua[1])||a(Ua[2])||a(Ua[3])||a(Ua[4])||a(Ua[5])||c(kc[0])||c(kc[1])||c(kc[2])||1==Qb[2]||1==
Qb[3])&&(f.physics.GG=f.physics.DENSITY,f.physics.BOUNCE=e,f.physics.memoryDY=0,f.physics.keyMoveDY=0,f.physics.flag1=!0);f.physics.keyMoveDY-=d;f.physics.GG+=f.physics.keyMoveDY;f.physics.NAME.y-=f.physics.GG};f.physicsPlayerCollision=function(a){0>f.physics.GG&&a.isStaticIntersect(f.physics.NAME.getStaticBoxS(0,f.physics.keyMoveDY,0,0))?(1==f.physics.test&&a.drawStaticBox(),f.physics.CollisionDown=!0,f.physics.NAME.y=a.y-f.physics.NAME.h+a.box.y-f.physics.NAME.box.h-f.physics.NAME.box.y,f.physics.m=
Math.abs(f.physics.GG),f.physics.keyMoveDY=0,f.physics.GG=0,0!=f.physics.BOUNCE&&f.physics.m>f.physics.minBounce&&(f.physics.GG=f.physics.m/f.physics.BOUNCE),0==f.physics.GG&&0==f.physics.keyMoveDY&&1==f.physics.flag1&&(f.physics.memoryDY=f.physics.NAME.y,f.physics.flag1=!1),0==f.physics.flag1&&(f.physics.GG=f.physics.ACCELETARIONDOWN)):f.physics.CollisionDown=!1;0<f.physics.GG&&a.isStaticIntersect(f.physics.NAME.getStaticBoxW(0,-f.physics.keyMoveDY,0,f.physics.ACCELETARIONDOWN))?(f.physics.CollisionUp=
!0,f.physics.NAME.y=a.y+a.h+a.box.h+a.box.y-f.physics.NAME.box.y,f.physics.GG=0,1==f.physics.test&&a.drawStaticBox(),0!=f.physics.STICKING&&(f.physics.keyMoveDY=f.physics.STICKING)):f.physics.CollisionUp=!1;a.isStaticIntersect(f.physics.NAME.getStaticBoxA(f.physics.keyMoveDX,0,-f.physics.keyMoveDX,f.physics.ACCELETARIONDOWN))?(f.physics.keyMoveDX=0,f.physics.CollisionLeft=!0,1==f.physics.test&&a.drawStaticBox(),f.physics.NAME.x=a.x+a.box.x+a.w-f.physics.NAME.box.x+a.box.w,1==f.physics.rtStop&&(f.physics.ROTATION=
0)):f.physics.CollisionLeft=!1;a.isStaticIntersect(f.physics.NAME.getStaticBoxD(0,0,f.physics.keyMoveDX,f.physics.ACCELETARIONDOWN))?(f.physics.keyMoveDX=0,f.physics.CollisionRight=!0,1==f.physics.test&&a.drawStaticBox(),f.physics.NAME.x=a.x-f.physics.NAME.w+a.box.x-f.physics.NAME.box.x-f.physics.NAME.box.w,1==f.physics.rtStop&&(f.physics.ROTATION=0)):f.physics.CollisionRight=!1};f.physicsPlayerMove=function(){f.physics.GG==f.physics.ACCELETARIONDOWN?(f.physics.keyMoveDX=pjs.math.toZiro(f.physics.keyMoveDX,
f.physics.FIRCTIONX),f.physics.ROTATION=pjs.math.toZiro(f.physics.ROTATION,f.physics.FIRCTIONR)):(f.physics.keyMoveDX=pjs.math.toZiro(f.physics.keyMoveDX,f.physics.DECAYJUMP),1==f.physics.NAME.roll&&(f.physics.ROTATION=pjs.math.toZiro(f.physics.ROTATION,f.physics.DECAYJUMP)));f.physics.NAME.move(f.physics.p(f.physics.keyMoveDX,f.physics.keyMoveDY));1==f.physics.NAME.roll&&f.physics.NAME.turn(f.physics.ROTATION);0!=f.physics.memoryDY&&f.physics.NAME.y>f.physics.memoryDY&&0==f.physics.flag1&&(f.physics.memoryDY=
0,f.physics.flag1=!0)};this.OOP.newRever=function(a,b,c){var d=function(e,l,n){this.min=e;this.max=l;this.step=n;this.value=e;this.to=n};d.prototype={update:function(){var e=this.value;this.value<=this.min?this.to=this.step:this.value>=this.max&&(this.to=-this.step);this.value+=this.to;return e},getValue:function(){return this.value},setValue:function(e){this.value=parseFloat(e)},setStep:function(e){this.step=e},getStep:function(){return this.step}};return new d(a,b,c)};var Qc={};this.OOP.once=function(a,
b){Qc[a]||(Qc[a]=!0,b())};this.OOP.newTimer=function(a,b){if(0>=a)return Aa("error in system.newTimer : variable < 0, Timer is not created");var c={time:0<a?a:1E3,func:b,startTime:!1,ending:!1,start:function(){this.ending||this.startTime||(this.startTime=da)},run:function(){!this.ending&&this.startTime&&da-this.startTime>=this.time&&(this.func(),this.ending=!0)},end:function(){this.ending||(this.ending=!0,this.func())},restart:function(d){this.startTime||this.start();if(this.ending){if(d&&0>=d)return Aa("error in Timer.restart : variable < 0");
d&&(this.time=d);this.ending=!1;this.startTime=da}},stop:function(){this.ending||(this.ending=!0)}};t.addEvent("postLoop","timer"+fa(-100,100)*fa(-100,100)+da,function(){c.run()});return c};this.memory.local={storage:m.localStorage,clear:function(){this.storage.clear()},save:function(a,b){this.storage.setItem(a,b)},saveAsObject:function(a,b){var c=JSON.stringify(b);this.storage.setItem(a,c)},loadAsObject:function(a){return JSON.parse(this.storage.getItem(a)||"false")},load:function(a){return this.storage.getItem(a)},
loadAsNumber:function(a){return parseFloat(this.storage.getItem(a))}};this.memory.temp={values:{},save:function(a,b){this.values[a]=b},load:function(a){return this.values[a]},loadAsNumber:function(a){return parseFloat(this.values[a])}};m.addEventListener("load",function(){if(k){for(var a in z)k[a]=z[a];k.save()}t.runEvent("onload");t.loaded=!0;V||(m.document.body.style.overflow="hidden");"function"===typeof POINTJS_USER_ONLOAD&&POINTJS_USER_ONLOAD();return!1});m.addEventListener("blur",function(){if(ya)return t.runEvent("gameBlur"),
!1});m.addEventListener("focus",function(){if(!ya)return m.document.activeElement.blur(),m.focus(),t.runEvent("gameFocus"),!1});m.addEventListener("resize",function(){t.runEvent("gameResize");k&&(k.textBaseline=z.textBaseline,q/=Fa,r/=Ga,S=q/2,T=r/2,k.scale(Fa,Ga));return!1});(V?x:m).addEventListener("click",function(){m.document.activeElement&&m.document.activeElement.blur();m.focus()});if("undefined"!==typeof POINTJS_LOADED_DOM_IGNORE)m.onload();"undefined"!==typeof POINTJS_ENGINE_CREATED_EVENT&&
POINTJS_ENGINE_CREATED_EVENT(this)}
var presetsParticle=function(){var R=function(y,U,m,F,V,Ca,kb,lb,na,mb){this.ctx=pjs.system.getContext();na*=100;this.COLOR;var ta=pjs.math;this.dx=ta.random(-na,na,!0)/100;this.dy=ta.random(-na,na,!0)/100;this.startX=this.x=F+ta.random(-y,y);this.startY=this.y=V+ta.random(-U,U);this.speed=na/100;this.color1=Ca[0];this.color2=kb;this.radius=ta.random(1,lb,!0);this.lifeTime=mb;this.alpha=1;this.COLOR=0<this.color2[0].length?this.color2[0][ta.random(0,this.color2[0].length-1,!1)]:0;this.RandCol=ta.random(-this.color2[1],
this.color2[1],!1);this.type={circle:0,gravity:1,fire:2,smoke:3}[m];3===this.type&&(this.alpha=.8)};R.prototype.draw=function(y){1===this.type?this.dy+=this.speed/10:2===this.type?(1<this.radius&&(this.radius-=this.speed/10),0<this.dy&&(this.dy=0),this.dy-=this.speed/20,0<this.radius&&(this.radius-=this.speed/10)):3===this.type&&(0<this.dy&&(this.dy=-.5),this.dy-=this.speed/100);0>=this.dx&&(this.dx+=this.speed/20);0<=this.dx&&(this.dx-=this.speed/20);this.x+=this.dx*pjs.game.getDT(10);this.y+=this.dy*
pjs.game.getDT(10);this.alpha-=this.lifeTime;0>this.alpha||(y=this.ctx.globalAlpha,this.ctx.globalAlpha=this.alpha,pjs.brush.drawRect({x:this.x-this.radius,y:this.y-this.radius,w:this.radius,h:this.radius,fillColor:this.color1}),this.RandCol==this.color2[1]&&pjs.brush.drawRect({x:this.x-this.radius,y:this.y-this.radius,w:this.radius,h:this.radius,fillColor:this.COLOR}),this.ctx.globalAlpha=y)};pjs.particles={};pjs.particles.setDensity=function(y){density=y};pjs.particles.create=function(y){for(var U in y.arr)y.arr[U].draw(),
0<y.arr.length&&y.arr[U].alpha<y.Color3[1]&&(y.arr[U].color1=y.Color3[0]),(0>=y.arr[U].alpha||1>y.arr[U].radius)&&y.arr.splice(U,1);if(!(y.arr.length>y.particleCount)&&y.density)for(U=0;U<=y.density;U++)y.arr.push(new R(y.width||1,y.height||1,y.type||"fire",y.position.x||0,y.position.y||0,y.Color1,y.Color2,y.size,y.speed||10,y.lifeTime||.01))}};